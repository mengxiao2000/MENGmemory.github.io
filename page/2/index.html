<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content="#58b77a">
  <title>黎明已经不远</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Syiao">
  <meta name="keywords" content>
  <meta name="description" content="“多新鲜啊~~”">
  <script id="hexo-configurations">
  var CONFIG = {
    root: '/mengxiao2000.github.io/',
    theme: 'lx',
    version: '0.3.9',
    localsearch:{
      "enable": false,
      "trigger": "auto",
      "top_n_per_article": 1,
      "unescape": false,
      "preload": false
      },
    path: 'null'
  };
</script>

  <link rel="shortcut icon" href="/mengxiao2000.github.io/favicon.ico">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/css/main.min.css">
  <style type="text/css">
    pre,
    code {
      font-family: 'Fira Code', monospace;
    }
    html {
      font-family: sans-serif;
    }
    body {
      font-family: sans-serif;
    }
    h1, h2, h3, h4, h5, figure {
      font-family: sans-serif;
    }
    .menu-container{
      font-family: sans-serif;
    }
  </style>

  <script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.jside.menu.js"></script>
	<script>
	$(document).ready(function(){
	$(".menu-container").jSideMenu({
	    jSidePosition: "position-right",
	    jSideSticky: true,
	    jSideSkin: "greenish",
	     });
	}); 
	</script>
  <!--baidu_analytics-->
<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e191a1666c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
<link rel="alternate" href="/mengxiao2000.github.io/atom.xml" title="黎明已经不远" type="application/atom+xml">
</head>
<body>
<div id="page">

<div id="lx-aside" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/cover.jpeg)">
  <div class="overlay">
  <div class="featured">
    <div class="avatar"><a href="/mengxiao2000.github.io/"><img src="/mengxiao2000.github.io/images/avatar.jpeg"></a></div>
    <span>Syiao</span>
    <h1>黎明已经不远</h1>
    <span>——洗洗睡吧</span>
    
  </div>
  </div>
</div>

<div id="lx-main-content">
  <div class="lx-post">

  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2020/02/20/nbviewer/">markdown中显示jupyter笔记本的方法</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2020-02-20 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/jupyter/">jupyter</a></span>
      <p></p><p>因为jupyter非常的简洁美观，一般都把code放在.ipynb文件中，但是.ipynb好像直接导出为markdown会出现大片空白，操作繁琐且不美观。</p>
<p>但是jupyter好像提供了一个在线分享notebook的方案，就是通过nbviewer这个东西。</p>
<p>方法简单：</p>
<ol>
<li>上传.ipynb文件到github</li>
<li>把github的文件路径放到nbviewer里</li>
<li>因为markdown支持html,可以把生成的链接的放在markdown中上传</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;https://nbviewer.jupyter.org/github/MENGmemory/sklearn_study/blob/master/preprocessing.ipynb&quot; width=&quot;570&quot; height=&quot;2000&quot;&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
<p>但是还是不想传，太懒。</p>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2020/02/20/nbviewer/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2020/01/10/preprocessing/">sklearn特征工程01</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2020-01-10 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/python/">python</a></span>
      <p><iframe src="https://nbviewer.jupyter.org/github/MENGmemory/sklearn_study/blob/master/preprocessing.ipynb" width="570" height="2000"></iframe></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2020/01/10/preprocessing/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/08/pandas/">pandas引入、选择数据、赋值与操作</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-08 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/python/">python</a></span>
      <p></p><h1 id="基础引入"><a href="#基础引入" class="headerlink" title="基础引入"></a>基础引入</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">irisdata = pd.read_csv(<span class="string">'iris.txt'</span>, header=<span class="literal">None</span>,  encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">irisdata[:<span class="number">30</span>]</span><br><span class="line"><span class="comment"># help(irisdata)</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>0</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>Sepal.Length “Sepal.Width” “Petal.Length” “Pet…</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>1 5.1 3.5 1.4 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>2 4.9 3 1.4 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>3 4.7 3.2 1.3 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>4 4.6 3.1 1.5 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>5 5 3.6 1.4 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>6</th><br>      <td>6 5.4 3.9 1.7 0.4 “setosa”</td><br>    </tr><br>    <tr><br>      <th>7</th><br>      <td>7 4.6 3.4 1.4 0.3 “setosa”</td><br>    </tr><br>    <tr><br>      <th>8</th><br>      <td>8 5 3.4 1.5 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>9</th><br>      <td>9 4.4 2.9 1.4 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>10</th><br>      <td>10 4.9 3.1 1.5 0.1 “setosa”</td><br>    </tr><br>    <tr><br>      <th>11</th><br>      <td>11 5.4 3.7 1.5 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>12</th><br>      <td>12 4.8 3.4 1.6 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>13</th><br>      <td>13 4.8 3 1.4 0.1 “setosa”</td><br>    </tr><br>    <tr><br>      <th>14</th><br>      <td>14 4.3 3 1.1 0.1 “setosa”</td><br>    </tr><br>    <tr><br>      <th>15</th><br>      <td>15 5.8 4 1.2 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>16</th><br>      <td>16 5.7 4.4 1.5 0.4 “setosa”</td><br>    </tr><br>    <tr><br>      <th>17</th><br>      <td>17 5.4 3.9 1.3 0.4 “setosa”</td><br>    </tr><br>    <tr><br>      <th>18</th><br>      <td>18 5.1 3.5 1.4 0.3 “setosa”</td><br>    </tr><br>    <tr><br>      <th>19</th><br>      <td>19 5.7 3.8 1.7 0.3 “setosa”</td><br>    </tr><br>    <tr><br>      <th>20</th><br>      <td>20 5.1 3.8 1.5 0.3 “setosa”</td><br>    </tr><br>    <tr><br>      <th>21</th><br>      <td>21 5.4 3.4 1.7 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>22</th><br>      <td>22 5.1 3.7 1.5 0.4 “setosa”</td><br>    </tr><br>    <tr><br>      <th>23</th><br>      <td>23 4.6 3.6 1 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>24</th><br>      <td>24 5.1 3.3 1.7 0.5 “setosa”</td><br>    </tr><br>    <tr><br>      <th>25</th><br>      <td>25 4.8 3.4 1.9 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>26</th><br>      <td>26 5 3 1.6 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>27</th><br>      <td>27 5 3.4 1.6 0.4 “setosa”</td><br>    </tr><br>    <tr><br>      <th>28</th><br>      <td>28 5.2 3.5 1.5 0.2 “setosa”</td><br>    </tr><br>    <tr><br>      <th>29</th><br>      <td>29 5.2 3.4 1.4 0.2 “setosa”</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sl = pd.Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">-2</span>]) <span class="comment">#pandas基于numpy，索引为默认值</span></span><br><span class="line">print(sl)</span><br></pre></td></tr></table></figure>
<pre><code>0    4
1    7
2    9
3   -2
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sl.values</span><br></pre></td></tr></table></figure>
<pre><code>array([ 4,  7,  9, -2])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sl.index</span><br></pre></td></tr></table></figure>
<pre><code>RangeIndex(start=0, stop=4, step=1)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s2 = pd.Series([<span class="number">2.0</span>, <span class="number">2.1</span>, <span class="number">3.3</span>, <span class="number">3.1</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]) <span class="comment"># 自定义索引</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s2</span><br></pre></td></tr></table></figure>
<pre><code>a    2.0
b    2.1
c    3.3
d    3.1
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s2[<span class="string">'a'</span>]</span><br></pre></td></tr></table></figure>
<pre><code>2.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s2[[<span class="string">'a'</span>, <span class="string">'b'</span>,<span class="string">'d'</span>]]</span><br></pre></td></tr></table></figure>
<pre><code>a    2.0
b    2.1
d    3.1
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'b'</span> <span class="keyword">in</span> s2</span><br></pre></td></tr></table></figure>
<pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'e'</span> <span class="keyword">in</span> s2</span><br></pre></td></tr></table></figure>
<pre><code>False
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Series可以看做一个定长的字典</span></span><br><span class="line">dic1 = &#123;<span class="string">'apple'</span>:<span class="number">1</span>, <span class="string">'peer'</span>:<span class="number">2</span>, <span class="string">'pen'</span>:<span class="number">5</span>&#125;</span><br><span class="line">s3 = pd.Series(dic1)</span><br><span class="line">s3</span><br></pre></td></tr></table></figure>
<pre><code>apple    1
peer     2
pen      5
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;<span class="string">'year'</span>:[<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>],</span><br><span class="line">       <span class="string">'income'</span>:[<span class="number">1000</span>, <span class="number">2000</span>, <span class="number">2400</span>],</span><br><span class="line">       <span class="string">'output'</span>:[<span class="number">200</span>, <span class="number">400</span>, <span class="number">900</span>]&#125;</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(data)</span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>year</th><br>      <th>income</th><br>      <th>output</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>2014</td><br>      <td>1000</td><br>      <td>200</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>2015</td><br>      <td>2000</td><br>      <td>400</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>2016</td><br>      <td>2400</td><br>      <td>900</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>0</th><br>      <th>1</th><br>      <th>2</th><br>      <th>3</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>], columns=[<span class="number">2</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>2</th><br>      <th>33</th><br>      <th>44</th><br>      <th>55</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>a</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>c</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>b</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.columns <span class="comment">#列属性</span></span><br></pre></td></tr></table></figure>
<pre><code>Index([&apos;year&apos;, &apos;income&apos;, &apos;output&apos;], dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.index</span><br></pre></td></tr></table></figure>
<pre><code>RangeIndex(start=0, stop=3, step=1)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3.index</span><br></pre></td></tr></table></figure>
<pre><code>Index([&apos;a&apos;, &apos;c&apos;, &apos;b&apos;], dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.values</span><br></pre></td></tr></table></figure>
<pre><code>array([[2014, 1000,  200],
       [2015, 2000,  400],
       [2016, 2400,  900]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.describe()</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>year</th><br>      <th>income</th><br>      <th>output</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>count</th><br>      <td>3.0</td><br>      <td>3.000000</td><br>      <td>3.000000</td><br>    </tr><br>    <tr><br>      <th>mean</th><br>      <td>2015.0</td><br>      <td>1800.000000</td><br>      <td>500.000000</td><br>    </tr><br>    <tr><br>      <th>std</th><br>      <td>1.0</td><br>      <td>721.110255</td><br>      <td>360.555128</td><br>    </tr><br>    <tr><br>      <th>min</th><br>      <td>2014.0</td><br>      <td>1000.000000</td><br>      <td>200.000000</td><br>    </tr><br>    <tr><br>      <th>25%</th><br>      <td>2014.5</td><br>      <td>1500.000000</td><br>      <td>300.000000</td><br>    </tr><br>    <tr><br>      <th>50%</th><br>      <td>2015.0</td><br>      <td>2000.000000</td><br>      <td>400.000000</td><br>    </tr><br>    <tr><br>      <th>75%</th><br>      <td>2015.5</td><br>      <td>2200.000000</td><br>      <td>650.000000</td><br>    </tr><br>    <tr><br>      <th>max</th><br>      <td>2016.0</td><br>      <td>2400.000000</td><br>      <td>900.000000</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.T</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>0</th><br>      <th>1</th><br>      <th>2</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>year</th><br>      <td>2014</td><br>      <td>2015</td><br>      <td>2016</td><br>    </tr><br>    <tr><br>      <th>income</th><br>      <td>1000</td><br>      <td>2000</td><br>      <td>2400</td><br>    </tr><br>    <tr><br>      <th>output</th><br>      <td>200</td><br>      <td>400</td><br>      <td>900</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3.sort_index(axis=<span class="number">1</span>) <span class="comment">#列排序</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>2</th><br>      <th>33</th><br>      <th>44</th><br>      <th>55</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>a</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>c</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>b</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3.sort_index(axis=<span class="number">0</span>)<span class="comment">#行排序</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>2</th><br>      <th>33</th><br>      <th>44</th><br>      <th>55</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>a</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>b</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>c</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3.sort_values(by=<span class="number">44</span>) <span class="comment">#按照某一列的值进行排序</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>2</th><br>      <th>33</th><br>      <th>44</th><br>      <th>55</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>a</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>c</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>b</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>  </tbody><br></table><br></div>



<h1 id="选择数据"><a href="#选择数据" class="headerlink" title="选择数据"></a>选择数据</h1><h1 id="方法如下："><a href="#方法如下：" class="headerlink" title="方法如下："></a>方法如下：</h1><p>df.loc() 按标签名称定位 先行后列</p>
<p>df.iloc() 按位置定位  行、列</p>
<p>df.ix() 混合定位</p>
<p>df[df.A&gt;9] 条件定位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dates = pd.date_range(<span class="string">'20170101'</span>, periods=<span class="number">6</span>) <span class="comment">#日期序列</span></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>,<span class="number">4</span>)), index=dates, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-01</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>2017-01-02</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2017-01-03</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>2017-01-04</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>2017-01-05</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>2017-01-06</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1[<span class="string">'a'</span>] <span class="comment">#将dataframe的列获取为一个series</span></span><br></pre></td></tr></table></figure>
<pre><code>2017-01-01     0
2017-01-02     4
2017-01-03     8
2017-01-04    12
2017-01-05    16
2017-01-06    20
Freq: D, Name: a, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.a</span><br></pre></td></tr></table></figure>
<pre><code>2017-01-01     0
2017-01-02     4
2017-01-03     8
2017-01-04    12
2017-01-05    16
2017-01-06    20
Freq: D, Name: a, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1[<span class="number">0</span>:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-01</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>2017-01-02</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1[<span class="string">'20170102'</span>:<span class="string">'20170104'</span>]</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-02</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2017-01-03</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>2017-01-04</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过标签选择数据</span></span><br><span class="line">df1.loc[<span class="string">'20170102'</span>]</span><br></pre></td></tr></table></figure>
<pre><code>a    4
b    5
c    6
d    7
Name: 2017-01-02 00:00:00, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.loc[<span class="string">'20170102'</span>, [<span class="string">'a'</span>,<span class="string">'c'</span>]] <span class="comment">#前面行索引名字 后面是列标签</span></span><br></pre></td></tr></table></figure>
<pre><code>a    4
c    6
Name: 2017-01-02 00:00:00, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.loc[:,[<span class="string">'a'</span>,<span class="string">'b'</span>]]</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-01</th><br>      <td>0</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>2017-01-02</th><br>      <td>4</td><br>      <td>5</td><br>    </tr><br>    <tr><br>      <th>2017-01-03</th><br>      <td>8</td><br>      <td>9</td><br>    </tr><br>    <tr><br>      <th>2017-01-04</th><br>      <td>12</td><br>      <td>13</td><br>    </tr><br>    <tr><br>      <th>2017-01-05</th><br>      <td>16</td><br>      <td>17</td><br>    </tr><br>    <tr><br>      <th>2017-01-06</th><br>      <td>20</td><br>      <td>21</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过位置选择数据</span></span><br><span class="line">df1.iloc[<span class="number">2</span>] <span class="comment">#第三行</span></span><br></pre></td></tr></table></figure>
<pre><code>a     8
b     9
c    10
d    11
Name: 2017-01-03 00:00:00, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.iloc[<span class="number">1</span>:<span class="number">3</span>, <span class="number">2</span>:<span class="number">4</span>] <span class="comment">#前面是行 后面是列</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-02</th><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2017-01-03</th><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-01</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>2017-01-02</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2017-01-03</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>2017-01-04</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>2017-01-05</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>2017-01-06</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.iloc[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>], [<span class="number">1</span>,<span class="number">3</span>]] <span class="comment">#都是位置索引</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>b</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-02</th><br>      <td>5</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2017-01-03</th><br>      <td>9</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>2017-01-05</th><br>      <td>17</td><br>      <td>19</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#混合标签位置选择</span></span><br><span class="line">df1.ix[<span class="number">2</span>:<span class="number">4</span>, [<span class="string">'a'</span>,<span class="string">'c'</span>]]</span><br></pre></td></tr></table></figure>
<pre><code>/root/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:2: DeprecationWarning: 
.ix is deprecated. Please use
.loc for label based indexing or
.iloc for positional indexing

See the documentation here:
http://pandas.pydata.org/pandas-docs/stable/indexing.html#ix-indexer-is-deprecated
</code></pre><div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>c</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-03</th><br>      <td>8</td><br>      <td>10</td><br>    </tr><br>    <tr><br>      <th>2017-01-04</th><br>      <td>12</td><br>      <td>14</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.ix[<span class="string">'20170101'</span>:<span class="string">'20170104'</span>, <span class="number">2</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<pre><code>/root/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: DeprecationWarning: 
.ix is deprecated. Please use
.loc for label based indexing or
.iloc for positional indexing

See the documentation here:
http://pandas.pydata.org/pandas-docs/stable/indexing.html#ix-indexer-is-deprecated
  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</code></pre><div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-01</th><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>2017-01-02</th><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2017-01-03</th><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>2017-01-04</th><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.a</span><br></pre></td></tr></table></figure>
<pre><code>2017-01-01     0
2017-01-02     4
2017-01-03     8
2017-01-04    12
2017-01-05    16
2017-01-06    20
Freq: D, Name: a, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.a &gt; <span class="number">6</span></span><br></pre></td></tr></table></figure>
<pre><code>2017-01-01    False
2017-01-02    False
2017-01-03     True
2017-01-04     True
2017-01-05     True
2017-01-06     True
Freq: D, Name: a, dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1[df1.a&gt;<span class="number">6</span>]</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>2017-01-03</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>2017-01-04</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>2017-01-05</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>2017-01-06</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>  </tbody><br></table><br></div>



<h1 id="赋值与操作"><a href="#赋值与操作" class="headerlink" title="赋值与操作"></a>赋值与操作</h1><h1 id="方法如下：-1"><a href="#方法如下：-1" class="headerlink" title="方法如下："></a>方法如下：</h1><p>通过定位赋值</p>
<p>df.append()添加行</p>
<p>df.insert()在指定位置插入指定名称的列</p>
<p>df.pop()弹出指定列</p>
<p>df.drop()删除多列或多行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dates = np.arange(<span class="number">20170101</span>, <span class="number">20170107</span>)</span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">24</span>).reshape((<span class="number">6</span>,<span class="number">4</span>)), index=dates, columns=[<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>])</span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.iloc[<span class="number">2</span>,<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<pre><code>10
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1.iloc[<span class="number">2</span>,<span class="number">2</span>] = <span class="number">100</span> </span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8</td><br>      <td>9</td><br>      <td>100</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1.loc[<span class="number">20170103</span>, <span class="string">'B'</span>] = <span class="number">200</span></span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8</td><br>      <td>200</td><br>      <td>100</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1[df1.A &gt; <span class="number">10</span>] = <span class="number">0</span> </span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8</td><br>      <td>200</td><br>      <td>100</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>0</td><br>      <td>0</td><br>      <td>0</td><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>0</td><br>      <td>0</td><br>      <td>0</td><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>0</td><br>      <td>0</td><br>      <td>0</td><br>      <td>0</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1[df1.A == <span class="number">0</span>] = <span class="number">1</span>  </span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8</td><br>      <td>200</td><br>      <td>100</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1[<span class="string">'E'</span>] = <span class="number">10</span>  <span class="comment">#添加一列</span></span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>      <td>10</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8</td><br>      <td>200</td><br>      <td>100</td><br>      <td>11</td><br>      <td>10</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1[<span class="string">'F'</span>] = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>], index=df1.index <span class="comment">#添加一列</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>      <td>10</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8</td><br>      <td>200</td><br>      <td>100</td><br>      <td>11</td><br>      <td>10</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>      <td>4</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>      <td>5</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1</td><br>      <td>10</td><br>      <td>6</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1.loc[<span class="string">'20170107'</span>, [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">"D"</span>]] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] </span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8.0</td><br>      <td>200.0</td><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>6.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>])</span><br><span class="line">s1.name = <span class="string">'S1'</span></span><br><span class="line">df2 = df1.append(s1)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8.0</td><br>      <td>200.0</td><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>6.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>S1</th><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#插入列</span></span><br><span class="line">df1.insert(<span class="number">1</span>, <span class="string">'G'</span>, df2[<span class="string">'E'</span>]) <span class="comment">#在列1的位置插入 索引为G的列</span></span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>G</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8.0</td><br>      <td>10.0</td><br>      <td>200.0</td><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>6.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>1.0</td><br>      <td>NaN</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g = df1.pop(<span class="string">'G'</span>) <span class="comment">#弹出G列 </span></span><br><span class="line">df1.insert(<span class="number">6</span>, <span class="string">'G'</span>, g) <span class="comment">#插入到最后</span></span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>      <th>G</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>      <td>10.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8.0</td><br>      <td>200.0</td><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>      <td>10.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>      <td>10.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>      <td>10.0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>6.0</td><br>      <td>10.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> df1[<span class="string">'G'</span>] <span class="comment">#删除G列</span></span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8.0</td><br>      <td>200.0</td><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>6.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df2 = df1.drop([<span class="string">'A'</span>, <span class="string">'B'</span>], axis=<span class="number">1</span>) <span class="comment">#删除多列</span></span><br><span class="line">df2</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>6.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8.0</td><br>      <td>200.0</td><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>20170106</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>6.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3 = df1.drop([<span class="number">20170106</span>], axis=<span class="number">0</span>)<span class="comment">#删除行</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>      <th>F</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>10.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>8.0</td><br>      <td>200.0</td><br>      <td>100.0</td><br>      <td>11.0</td><br>      <td>10.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>20170105</th><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>1.0</td><br>      <td>10.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>20170107</th><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>4.0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.index</span><br></pre></td></tr></table></figure>
<pre><code>Index([20170101, 20170102, 20170103, 20170104, 20170105, 20170106, &apos;20170107&apos;], dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/08/pandas/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/08/Pandas数据分析/">Pandas处理丢失数据、读写文件、数据合并、绘图</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-08 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/python/">python</a></span>
      <p></p><h1 id="处理丢失数据"><a href="#处理丢失数据" class="headerlink" title="处理丢失数据"></a>处理丢失数据</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dates = np.arange(<span class="number">20170101</span>, <span class="number">20170105</span>)</span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">4</span>,<span class="number">3</span>)), index = dates , columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>])</span><br><span class="line">df1</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>3</td><br>      <td>4</td><br>      <td>5</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>6</td><br>      <td>7</td><br>      <td>8</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df2 = pd.DataFrame(df1, index=dates, columns=[<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>])</span><br><span class="line">df2</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>3</td><br>      <td>4</td><br>      <td>5</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>6</td><br>      <td>7</td><br>      <td>8</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s1 = pd.Series([<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>], index=dates[<span class="number">0</span>:<span class="number">3</span>])</span><br><span class="line">s2 = pd.Series([<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>], index=dates[<span class="number">1</span>:])</span><br><span class="line">df2[<span class="string">'D'</span>] = s1 </span><br><span class="line">df2[<span class="string">'E'</span>] = s2</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3.0</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>3</td><br>      <td>4</td><br>      <td>5</td><br>      <td>4.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>6</td><br>      <td>7</td><br>      <td>8</td><br>      <td>6.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>      <td>NaN</td><br>      <td>5.0</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df2.dropna(axis=<span class="number">0</span>, how=<span class="string">'any'</span>) <span class="comment">#axis=[0,1] 0代表行， 1代表列  how=['any', 'all'] any任意一个 all代表全部</span></span><br><span class="line"><span class="comment"># any就是如果有一个是空 就删除此行</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170102</th><br>      <td>3</td><br>      <td>4</td><br>      <td>5</td><br>      <td>4.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>6</td><br>      <td>7</td><br>      <td>8</td><br>      <td>6.0</td><br>      <td>2.0</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2.dropna(axis=<span class="number">1</span>, how=<span class="string">'any'</span>)</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>3</td><br>      <td>4</td><br>      <td>5</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>6</td><br>      <td>7</td><br>      <td>8</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2.fillna(value=<span class="number">0</span>) <span class="comment">#赋值空值</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3.0</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>3</td><br>      <td>4</td><br>      <td>5</td><br>      <td>4.0</td><br>      <td>3.0</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>6</td><br>      <td>7</td><br>      <td>8</td><br>      <td>6.0</td><br>      <td>2.0</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>      <td>0.0</td><br>      <td>5.0</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2.isnull() <span class="comment">#查看空值</span></span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>E</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>20170101</th><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>      <td>True</td><br>    </tr><br>    <tr><br>      <th>20170102</th><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>    </tr><br>    <tr><br>      <th>20170103</th><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>    </tr><br>    <tr><br>      <th>20170104</th><br>      <td>False</td><br>      <td>False</td><br>      <td>False</td><br>      <td>True</td><br>      <td>False</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.any(df2.isnull())  <span class="comment">#只要有一个空值就返回True</span></span><br></pre></td></tr></table></figure>
<pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.all(df2.isnull()) <span class="comment">#所有为空值才返回true</span></span><br></pre></td></tr></table></figure>
<pre><code>False
</code></pre><h1 id="读取与写入文件"><a href="#读取与写入文件" class="headerlink" title="读取与写入文件"></a>读取与写入文件</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file = pd.read_csv(<span class="string">'./datasets/housing/housing.csv'</span>,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">file.head()</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>longitude</th><br>      <th>latitude</th><br>      <th>housing_median_age</th><br>      <th>total_rooms</th><br>      <th>total_bedrooms</th><br>      <th>population</th><br>      <th>households</th><br>      <th>median_income</th><br>      <th>median_house_value</th><br>      <th>ocean_proximity</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>-122.23</td><br>      <td>37.88</td><br>      <td>41.0</td><br>      <td>880.0</td><br>      <td>129.0</td><br>      <td>322.0</td><br>      <td>126.0</td><br>      <td>8.3252</td><br>      <td>452600.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>-122.22</td><br>      <td>37.86</td><br>      <td>21.0</td><br>      <td>7099.0</td><br>      <td>1106.0</td><br>      <td>2401.0</td><br>      <td>1138.0</td><br>      <td>8.3014</td><br>      <td>358500.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>-122.24</td><br>      <td>37.85</td><br>      <td>52.0</td><br>      <td>1467.0</td><br>      <td>190.0</td><br>      <td>496.0</td><br>      <td>177.0</td><br>      <td>7.2574</td><br>      <td>352100.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>-122.25</td><br>      <td>37.85</td><br>      <td>52.0</td><br>      <td>1274.0</td><br>      <td>235.0</td><br>      <td>558.0</td><br>      <td>219.0</td><br>      <td>5.6431</td><br>      <td>341300.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>-122.25</td><br>      <td>37.85</td><br>      <td>52.0</td><br>      <td>1627.0</td><br>      <td>280.0</td><br>      <td>565.0</td><br>      <td>259.0</td><br>      <td>3.8462</td><br>      <td>342200.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.sort_values(by=<span class="string">'housing_median_age'</span>).head()</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>longitude</th><br>      <th>latitude</th><br>      <th>housing_median_age</th><br>      <th>total_rooms</th><br>      <th>total_bedrooms</th><br>      <th>population</th><br>      <th>households</th><br>      <th>median_income</th><br>      <th>median_house_value</th><br>      <th>ocean_proximity</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>3130</th><br>      <td>-117.95</td><br>      <td>35.08</td><br>      <td>1.0</td><br>      <td>83.0</td><br>      <td>15.0</td><br>      <td>32.0</td><br>      <td>15.0</td><br>      <td>4.8750</td><br>      <td>141700.0</td><br>      <td>INLAND</td><br>    </tr><br>    <tr><br>      <th>19536</th><br>      <td>-120.93</td><br>      <td>37.65</td><br>      <td>1.0</td><br>      <td>2254.0</td><br>      <td>328.0</td><br>      <td>402.0</td><br>      <td>112.0</td><br>      <td>4.2500</td><br>      <td>189200.0</td><br>      <td>INLAND</td><br>    </tr><br>    <tr><br>      <th>12286</th><br>      <td>-116.95</td><br>      <td>33.86</td><br>      <td>1.0</td><br>      <td>6.0</td><br>      <td>2.0</td><br>      <td>8.0</td><br>      <td>2.0</td><br>      <td>1.6250</td><br>      <td>55000.0</td><br>      <td>INLAND</td><br>    </tr><br>    <tr><br>      <th>18972</th><br>      <td>-122.00</td><br>      <td>38.23</td><br>      <td>1.0</td><br>      <td>2062.0</td><br>      <td>343.0</td><br>      <td>872.0</td><br>      <td>268.0</td><br>      <td>5.2636</td><br>      <td>191300.0</td><br>      <td>INLAND</td><br>    </tr><br>    <tr><br>      <th>10391</th><br>      <td>-117.65</td><br>      <td>33.58</td><br>      <td>2.0</td><br>      <td>2411.0</td><br>      <td>354.0</td><br>      <td>703.0</td><br>      <td>217.0</td><br>      <td>7.8061</td><br>      <td>331400.0</td><br>      <td>&lt;1H OCEAN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.iloc[<span class="number">2</span>,<span class="number">0</span>] = <span class="number">-112.23</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.head()</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>longitude</th><br>      <th>latitude</th><br>      <th>housing_median_age</th><br>      <th>total_rooms</th><br>      <th>total_bedrooms</th><br>      <th>population</th><br>      <th>households</th><br>      <th>median_income</th><br>      <th>median_house_value</th><br>      <th>ocean_proximity</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>-122.23</td><br>      <td>37.88</td><br>      <td>41.0</td><br>      <td>880.0</td><br>      <td>129.0</td><br>      <td>322.0</td><br>      <td>126.0</td><br>      <td>8.3252</td><br>      <td>452600.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>-122.22</td><br>      <td>37.86</td><br>      <td>21.0</td><br>      <td>7099.0</td><br>      <td>1106.0</td><br>      <td>2401.0</td><br>      <td>1138.0</td><br>      <td>8.3014</td><br>      <td>358500.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>-122.24</td><br>      <td>37.85</td><br>      <td>52.0</td><br>      <td>1467.0</td><br>      <td>190.0</td><br>      <td>496.0</td><br>      <td>177.0</td><br>      <td>7.2574</td><br>      <td>352100.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>-122.25</td><br>      <td>37.85</td><br>      <td>52.0</td><br>      <td>1274.0</td><br>      <td>235.0</td><br>      <td>558.0</td><br>      <td>219.0</td><br>      <td>5.6431</td><br>      <td>341300.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>-122.25</td><br>      <td>37.85</td><br>      <td>52.0</td><br>      <td>1627.0</td><br>      <td>280.0</td><br>      <td>565.0</td><br>      <td>259.0</td><br>      <td>3.8462</td><br>      <td>342200.0</td><br>      <td>NEAR BAY</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.to_csv(<span class="string">'ceshidata.csv'</span>) <span class="comment">#存储</span></span><br></pre></td></tr></table></figure>
<h1 id="数据合并"><a href="#数据合并" class="headerlink" title="数据合并"></a>数据合并</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">12</span>,<span class="number">24</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">df3 = pd.DataFrame(np.arange(<span class="number">24</span>,<span class="number">36</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">print(df1)</span><br><span class="line">print(df2)</span><br><span class="line">print(df3)</span><br></pre></td></tr></table></figure>
<pre><code>   a  b   c   d
0  0  1   2   3
1  4  5   6   7
2  8  9  10  11
    a   b   c   d
0  12  13  14  15
1  16  17  18  19
2  20  21  22  23
    a   b   c   d
0  24  25  26  27
1  28  29  30  31
2  32  33  34  35
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df4 = pd.concat([df1, df2, df3], axis=<span class="number">0</span>)   <span class="comment">#行合并,改变行形态</span></span><br><span class="line">df4</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>0</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>    <tr><br>      <th>0</th><br>      <td>24</td><br>      <td>25</td><br>      <td>26</td><br>      <td>27</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>28</td><br>      <td>29</td><br>      <td>30</td><br>      <td>31</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>32</td><br>      <td>33</td><br>      <td>34</td><br>      <td>35</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df4 = pd.concat([df1, df2, df3], axis=<span class="number">0</span>, ignore_index=<span class="literal">True</span>)<span class="comment">#行合并，不考虑原来的index</span></span><br><span class="line">df4</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>    <tr><br>      <th>6</th><br>      <td>24</td><br>      <td>25</td><br>      <td>26</td><br>      <td>27</td><br>    </tr><br>    <tr><br>      <th>7</th><br>      <td>28</td><br>      <td>29</td><br>      <td>30</td><br>      <td>31</td><br>    </tr><br>    <tr><br>      <th>8</th><br>      <td>32</td><br>      <td>33</td><br>      <td>34</td><br>      <td>35</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df5 =pd.concat([df1, df2, df3], axis=<span class="number">1</span>) <span class="comment">#列合并，改变列形态</span></span><br><span class="line">df5</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15</td><br>      <td>24</td><br>      <td>25</td><br>      <td>26</td><br>      <td>27</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19</td><br>      <td>28</td><br>      <td>29</td><br>      <td>30</td><br>      <td>31</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>      <td>32</td><br>      <td>33</td><br>      <td>34</td><br>      <td>35</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">12</span>,<span class="number">24</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)), columns=[<span class="string">'a'</span>, <span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>])</span><br><span class="line">print(df1)</span><br><span class="line">print(df2)</span><br></pre></td></tr></table></figure>
<pre><code>   a  b   c   d
0  0  1   2   3
1  4  5   6   7
2  8  9  10  11
    a   c   d   e
0  12  13  14  15
1  16  17  18  19
2  20  21  22  23
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df6 = pd.concat([df1, df2], join=<span class="string">'outer'</span>, ignore_index=<span class="literal">True</span>) <span class="comment">#合并两个表，缺少的部分填充NaN</span></span><br><span class="line"></span><br><span class="line">df6</span><br></pre></td></tr></table></figure>
<pre><code>/root/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &apos;sort=False&apos;.

To retain the current behavior and silence the warning, pass &apos;sort=True&apos;.

  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</code></pre><div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>d</th><br>      <th>e</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0</td><br>      <td>1.0</td><br>      <td>2</td><br>      <td>3</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4</td><br>      <td>5.0</td><br>      <td>6</td><br>      <td>7</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8</td><br>      <td>9.0</td><br>      <td>10</td><br>      <td>11</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>12</td><br>      <td>NaN</td><br>      <td>13</td><br>      <td>14</td><br>      <td>15.0</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>16</td><br>      <td>NaN</td><br>      <td>17</td><br>      <td>18</td><br>      <td>19.0</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>20</td><br>      <td>NaN</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23.0</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df7 = pd.concat([df1, df2], join=<span class="string">'inner'</span>, ignore_index=<span class="literal">True</span>) <span class="comment">#合并两个表，缺少的部分去掉</span></span><br><span class="line">df7</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0</td><br>      <td>2</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4</td><br>      <td>6</td><br>      <td>7</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8</td><br>      <td>10</td><br>      <td>11</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>16</td><br>      <td>17</td><br>      <td>18</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>20</td><br>      <td>21</td><br>      <td>22</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'f'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">12</span>,<span class="number">24</span>).reshape((<span class="number">4</span>,<span class="number">3</span>)), columns=[<span class="string">'a'</span>, <span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">print(df1)</span><br><span class="line">print(df2)</span><br></pre></td></tr></table></figure>
<pre><code>   a  b   c   f
0  0  1   2   3
1  4  5   6   7
2  8  9  10  11
    a   c   d
0  12  13  14
1  15  16  17
2  18  19  20
3  21  22  23
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df8 = pd.concat([df1, df2], axis=<span class="number">1</span>, join_axes=[df1.index]) <span class="comment">#列合并， index使用df1的index</span></span><br><span class="line">df8</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>f</th><br>      <th>a</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0</td><br>      <td>1</td><br>      <td>2</td><br>      <td>3</td><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4</td><br>      <td>5</td><br>      <td>6</td><br>      <td>7</td><br>      <td>15</td><br>      <td>16</td><br>      <td>17</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8</td><br>      <td>9</td><br>      <td>10</td><br>      <td>11</td><br>      <td>18</td><br>      <td>19</td><br>      <td>20</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df8 = pd.concat([df1, df2], axis=<span class="number">1</span>) <span class="comment">#列合并， index使用df1的index</span></span><br><span class="line">df8</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>a</th><br>      <th>b</th><br>      <th>c</th><br>      <th>f</th><br>      <th>a</th><br>      <th>c</th><br>      <th>d</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>0.0</td><br>      <td>1.0</td><br>      <td>2.0</td><br>      <td>3.0</td><br>      <td>12</td><br>      <td>13</td><br>      <td>14</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>4.0</td><br>      <td>5.0</td><br>      <td>6.0</td><br>      <td>7.0</td><br>      <td>15</td><br>      <td>16</td><br>      <td>17</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>8.0</td><br>      <td>9.0</td><br>      <td>10.0</td><br>      <td>11.0</td><br>      <td>18</td><br>      <td>19</td><br>      <td>20</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>21</td><br>      <td>22</td><br>      <td>23</td><br>    </tr><br>  </tbody><br></table><br></div>



<h1 id="pandas-合并-merge"><a href="#pandas-合并-merge" class="headerlink" title="pandas 合并 merge"></a>pandas 合并 merge</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">left = pd.DataFrame(&#123;<span class="string">'key'</span>:[<span class="string">'K0'</span>,<span class="string">'K1'</span>,<span class="string">'K2'</span>,<span class="string">'K3'</span>], </span><br><span class="line">                    <span class="string">'A'</span>:[<span class="string">'A0'</span>,<span class="string">'A1'</span>,<span class="string">'A2'</span>,<span class="string">'A3'</span>],</span><br><span class="line">                    <span class="string">'B'</span>:[<span class="string">'B0'</span>,<span class="string">'B1'</span>,<span class="string">'B2'</span>,<span class="string">'B3'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(&#123;<span class="string">'key'</span>:[<span class="string">'K0'</span>,<span class="string">'K1'</span>,<span class="string">'K2'</span>,<span class="string">'K3'</span>],</span><br><span class="line">                     <span class="string">'C'</span>:[<span class="string">'C0'</span>,<span class="string">'C1'</span>,<span class="string">'C2'</span>,<span class="string">'C3'</span>],</span><br><span class="line">                     <span class="string">'D'</span>:[<span class="string">'D0'</span>,<span class="string">'D1'</span>,<span class="string">'D2'</span>,<span class="string">'D3'</span>]&#125;)</span><br><span class="line">print(left)</span><br><span class="line">print(right)</span><br></pre></td></tr></table></figure>
<pre><code>  key   A   B
0  K0  A0  B0
1  K1  A1  B1
2  K2  A2  B2
3  K3  A3  B3
  key   C   D
0  K0  C0  D0
1  K1  C1  D1
2  K2  C2  D2
3  K3  C3  D3
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = pd.merge(left, right, on=<span class="string">'key'</span>) <span class="comment">#左右合并 依据key这一列</span></span><br><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>key</th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>K0</td><br>      <td>A0</td><br>      <td>B0</td><br>      <td>C0</td><br>      <td>D0</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>K1</td><br>      <td>A1</td><br>      <td>B1</td><br>      <td>C1</td><br>      <td>D1</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>K2</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C2</td><br>      <td>D2</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>K3</td><br>      <td>A3</td><br>      <td>B3</td><br>      <td>C3</td><br>      <td>D3</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">left = pd.DataFrame(&#123;<span class="string">'key1'</span>:[<span class="string">'K0'</span>,<span class="string">'K0'</span>,<span class="string">'K1'</span>,<span class="string">'K2'</span>], </span><br><span class="line">                     <span class="string">'key2'</span>:[<span class="string">'K0'</span>,<span class="string">'K1'</span>,<span class="string">'K0'</span>,<span class="string">'K1'</span>], </span><br><span class="line">                    <span class="string">'A'</span>:[<span class="string">'A0'</span>,<span class="string">'A1'</span>,<span class="string">'A2'</span>,<span class="string">'A3'</span>],</span><br><span class="line">                    <span class="string">'B'</span>:[<span class="string">'B0'</span>,<span class="string">'B1'</span>,<span class="string">'B2'</span>,<span class="string">'B3'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(&#123;<span class="string">'key1'</span>:[<span class="string">'K0'</span>,<span class="string">'K1'</span>,<span class="string">'K1'</span>,<span class="string">'K3'</span>],</span><br><span class="line">                      <span class="string">'key2'</span>:[<span class="string">'K0'</span>,<span class="string">'K0'</span>,<span class="string">'K0'</span>,<span class="string">'K0'</span>], </span><br><span class="line">                     <span class="string">'C'</span>:[<span class="string">'C0'</span>,<span class="string">'C1'</span>,<span class="string">'C2'</span>,<span class="string">'C3'</span>],</span><br><span class="line">                     <span class="string">'D'</span>:[<span class="string">'D0'</span>,<span class="string">'D1'</span>,<span class="string">'D2'</span>,<span class="string">'D3'</span>]&#125;)</span><br><span class="line">print(left)</span><br><span class="line">print(right)</span><br></pre></td></tr></table></figure>
<pre><code>  key1 key2   A   B
0   K0   K0  A0  B0
1   K0   K1  A1  B1
2   K1   K0  A2  B2
3   K2   K1  A3  B3
  key1 key2   C   D
0   K0   K0  C0  D0
1   K1   K0  C1  D1
2   K1   K0  C2  D2
3   K3   K0  C3  D3
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#how = ['left','right', 'inner', 'outer']</span></span><br><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>,<span class="string">'key2'</span>], how=<span class="string">'outer'</span>) <span class="comment">#how默认inner </span></span><br><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>key1</th><br>      <th>key2</th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>K0</td><br>      <td>K0</td><br>      <td>A0</td><br>      <td>B0</td><br>      <td>C0</td><br>      <td>D0</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>K0</td><br>      <td>K1</td><br>      <td>A1</td><br>      <td>B1</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C1</td><br>      <td>D1</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C2</td><br>      <td>D2</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>K2</td><br>      <td>K1</td><br>      <td>A3</td><br>      <td>B3</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>K3</td><br>      <td>K0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>C3</td><br>      <td>D3</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>,<span class="string">'key2'</span>], how=<span class="string">'inner'</span>) <span class="comment">#how默认inner  只保留相同</span></span><br><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>key1</th><br>      <th>key2</th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>K0</td><br>      <td>K0</td><br>      <td>A0</td><br>      <td>B0</td><br>      <td>C0</td><br>      <td>D0</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C1</td><br>      <td>D1</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C2</td><br>      <td>D2</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(left)</span><br><span class="line">print(right)</span><br></pre></td></tr></table></figure>
<pre><code>  key1 key2   A   B
0   K0   K0  A0  B0
1   K0   K1  A1  B1
2   K1   K0  A2  B2
3   K2   K1  A3  B3
  key1 key2   C   D
0   K0   K0  C0  D0
1   K1   K0  C1  D1
2   K1   K0  C2  D2
3   K3   K0  C3  D3
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>,<span class="string">'key2'</span>], how=<span class="string">'left'</span>) <span class="comment">#how=left只考虑左边的dataframe</span></span><br><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>key1</th><br>      <th>key2</th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>K0</td><br>      <td>K0</td><br>      <td>A0</td><br>      <td>B0</td><br>      <td>C0</td><br>      <td>D0</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>K0</td><br>      <td>K1</td><br>      <td>A1</td><br>      <td>B1</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C1</td><br>      <td>D1</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C2</td><br>      <td>D2</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>K2</td><br>      <td>K1</td><br>      <td>A3</td><br>      <td>B3</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>,<span class="string">'key2'</span>], how=<span class="string">'outer'</span>, indicator=<span class="literal">True</span>) <span class="comment">#indicator显示merge信息</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>key1</th><br>      <th>key2</th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>_merge</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>K0</td><br>      <td>K0</td><br>      <td>A0</td><br>      <td>B0</td><br>      <td>C0</td><br>      <td>D0</td><br>      <td>both</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>K0</td><br>      <td>K1</td><br>      <td>A1</td><br>      <td>B1</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>left_only</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C1</td><br>      <td>D1</td><br>      <td>both</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C2</td><br>      <td>D2</td><br>      <td>both</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>K2</td><br>      <td>K1</td><br>      <td>A3</td><br>      <td>B3</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>left_only</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>K3</td><br>      <td>K0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>C3</td><br>      <td>D3</td><br>      <td>right_only</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = pd.merge(left, right, on=[<span class="string">'key1'</span>,<span class="string">'key2'</span>], how=<span class="string">'outer'</span>, indicator=<span class="string">'indicator_column'</span>)<span class="comment">#可定义列名</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>key1</th><br>      <th>key2</th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>      <th>indicator_column</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>K0</td><br>      <td>K0</td><br>      <td>A0</td><br>      <td>B0</td><br>      <td>C0</td><br>      <td>D0</td><br>      <td>both</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>K0</td><br>      <td>K1</td><br>      <td>A1</td><br>      <td>B1</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>left_only</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C1</td><br>      <td>D1</td><br>      <td>both</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>K1</td><br>      <td>K0</td><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C2</td><br>      <td>D2</td><br>      <td>both</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>K2</td><br>      <td>K1</td><br>      <td>A3</td><br>      <td>B3</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>left_only</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>K3</td><br>      <td>K0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>C3</td><br>      <td>D3</td><br>      <td>right_only</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">left = pd.DataFrame(&#123;<span class="string">'A'</span>:[<span class="string">'A0'</span>,<span class="string">'A1'</span>,<span class="string">'A2'</span>], </span><br><span class="line">                    <span class="string">'B'</span>:[<span class="string">'B0'</span>,<span class="string">'B1'</span>,<span class="string">'B2'</span>]&#125;,</span><br><span class="line">                   index = [<span class="string">'K0'</span>,<span class="string">'K1'</span>,<span class="string">'K2'</span>])</span><br><span class="line">right = pd.DataFrame(&#123;<span class="string">'C'</span>:[<span class="string">'C0'</span>,<span class="string">'C1'</span>,<span class="string">'C2'</span>],</span><br><span class="line">                     <span class="string">'D'</span>:[<span class="string">'D0'</span>,<span class="string">'D1'</span>,<span class="string">'D2'</span>]&#125;,</span><br><span class="line">                    index=[<span class="string">'K0'</span>,<span class="string">'K2'</span>,<span class="string">'K3'</span>])</span><br><span class="line"></span><br><span class="line">print(left)</span><br><span class="line">print(right)</span><br></pre></td></tr></table></figure>
<pre><code>     A   B
K0  A0  B0
K1  A1  B1
K2  A2  B2
     C   D
K0  C0  D0
K2  C1  D1
K3  C2  D2
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = pd.merge(left, right, left_index=<span class="literal">True</span>, right_index=<span class="literal">True</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>A</th><br>      <th>B</th><br>      <th>C</th><br>      <th>D</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>K0</th><br>      <td>A0</td><br>      <td>B0</td><br>      <td>C0</td><br>      <td>D0</td><br>    </tr><br>    <tr><br>      <th>K1</th><br>      <td>A1</td><br>      <td>B1</td><br>      <td>NaN</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>K2</th><br>      <td>A2</td><br>      <td>B2</td><br>      <td>C1</td><br>      <td>D1</td><br>    </tr><br>    <tr><br>      <th>K3</th><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>C2</td><br>      <td>D2</td><br>    </tr><br>  </tbody><br></table><br></div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">boys = pd.DataFrame(&#123;<span class="string">'k'</span>:[<span class="string">'K0'</span>,<span class="string">'K1'</span>,<span class="string">'K2'</span>], <span class="string">'age'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;)</span><br><span class="line">girls = pd.DataFrame(&#123;<span class="string">'k'</span>:[<span class="string">'K0'</span>,<span class="string">'K0'</span>,<span class="string">'K3'</span>],<span class="string">'age'</span>:[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]&#125;)</span><br><span class="line">print(boys)</span><br><span class="line">print(girls)</span><br></pre></td></tr></table></figure>
<pre><code>    k  age
0  K0    1
1  K1    2
2  K2    3
    k  age
0  K0    4
1  K0    5
2  K3    6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = pd.merge(boys, girls, on=<span class="string">'k'</span>, suffixes=[<span class="string">'_boy'</span>, <span class="string">'_girl'</span>], how=<span class="string">'outer'</span>)  <span class="comment">#suffixes 同名属性加后缀区分</span></span><br><span class="line">res</span><br></pre></td></tr></table></figure>
<div><br><style scoped><br>    .dataframe tbody tr th:only-of-type {<br>        vertical-align: middle;<br>    }<br><br>    .dataframe tbody tr th {<br>        vertical-align: top;<br>    }<br><br>    .dataframe thead th {<br>        text-align: right;<br>    }<br></style><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>k</th><br>      <th>age_boy</th><br>      <th>age_girl</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>K0</td><br>      <td>1.0</td><br>      <td>4.0</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>K0</td><br>      <td>1.0</td><br>      <td>5.0</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>K1</td><br>      <td>2.0</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>K2</td><br>      <td>3.0</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>K3</td><br>      <td>NaN</td><br>      <td>6.0</td><br>    </tr><br>  </tbody><br></table><br></div>



<h1 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series(np.random.randn(<span class="number">1000</span>), index=np.arange(<span class="number">1000</span>)) <span class="comment">#标准正态分布的随机数</span></span><br><span class="line">data = data.cumsum() <span class="comment">#累加</span></span><br><span class="line">data.plot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="output_48_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = np.random.randint(<span class="number">1</span>,<span class="number">10</span>,<span class="number">10</span>)</span><br><span class="line">print(x)</span><br><span class="line">x = x.cumsum()</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure>
<pre><code>[2 5 3 1 9 6 3 3 8 9]
[ 2  7 10 11 20 26 29 32 40 49]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data = pd.DataFrame(np.random.randn(<span class="number">1000</span>,<span class="number">4</span>), index=np.arange(<span class="number">1000</span>), columns=[<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>])</span><br><span class="line">data = data.cumsum() </span><br><span class="line">print(data.head())</span><br></pre></td></tr></table></figure>
<pre><code>          A         B         C         D
0  3.164961 -0.160822  1.628288  1.215791
1  4.190590 -1.004543  1.473195  2.405998
2  6.736750 -0.502750  1.995162  0.576967
3  6.306202 -1.891087  0.389709 -0.172805
4  4.185784 -3.004508  1.179027 -0.947929
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.plot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="output_51_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ax = data.plot.scatter(x=<span class="string">'A'</span>,y=<span class="string">'B'</span>, color=<span class="string">'Blue'</span>, label=<span class="string">'class 1'</span>)</span><br><span class="line">ax = data.plot.scatter(x=<span class="string">'A'</span>,y=<span class="string">'C'</span>, color=<span class="string">'yellow'</span>, label=<span class="string">'class 2'</span>, ax=ax)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="output_52_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>array([[0.72842962, 0.10975279],
       [0.15454685, 0.78988048],
       [0.74866068, 0.03565489]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/08/Pandas数据分析/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/06/EF6E429A-DD75-410E-BA1C-D2155AE088CB/">Tensorflow梯度消失/爆炸问题解决方案/使用预训练模型</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-06 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/深度学习/">深度学习</a></span>
      <p></p><h1 id="梯度消失-爆炸问题解决方案-使用预训练模型"><a href="#梯度消失-爆炸问题解决方案-使用预训练模型" class="headerlink" title="梯度消失/爆炸问题解决方案/使用预训练模型"></a>梯度消失/爆炸问题解决方案/使用预训练模型</h1><h2 id="连接权重初始化"><a href="#连接权重初始化" class="headerlink" title="连接权重初始化"></a>连接权重初始化</h2><h3 id="Xavier初始化（当使用逻辑激活函数时）"><a href="#Xavier初始化（当使用逻辑激活函数时）" class="headerlink" title="Xavier初始化（当使用逻辑激活函数时）"></a>Xavier初始化（当使用逻辑激活函数时）</h3><p>连接权重按照均值为零标准差为（2/(n_inputs+n_inputs))^1/2的正态分布，或者一个在-r和r之间的均匀分布，其中r=(6/(n_inputs+n_inputs))^1/2.当输入和输出连接数大体一致时，可以简化。</p>
<h3 id="He初始化（当使用ReLU激活函数时）"><a href="#He初始化（当使用ReLU激活函数时）" class="headerlink" title="He初始化（当使用ReLU激活函数时）"></a>He初始化（当使用ReLU激活函数时）</h3><p>公式变为根号2次幂</p>
<h3 id="双曲正切函数"><a href="#双曲正切函数" class="headerlink" title="双曲正切函数"></a>双曲正切函数</h3><p>公式变为根号4次幂</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>fully_connected()函数默认使用Xavier初始化（使用均匀分布）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">he_init = tf.variance_scaling_initializer()</span><br><span class="line">hidden1 = tf.layers.dense(X, n_hidden1,activation=tf.nn.relu, kernel_initializer=he_init, name=&quot;hidden1&quot;)</span><br></pre></td></tr></table></figure></p>
<h2 id="非饱和激活函数"><a href="#非饱和激活函数" class="headerlink" title="非饱和激活函数"></a>非饱和激活函数</h2><p>用ReLU时，在训练过程中，如果神经元的权重更新到神经元的输入的总权重时负值时，这个神经元就开始输出0，除非ReLu函数的梯度为零并且输入为负。<br>解决这个问题，可能需要对ReLU函数变种。</p>
<h3 id="LeakyReLU（带泄漏线性整流函数）"><a href="#LeakyReLU（带泄漏线性整流函数）" class="headerlink" title="LeakyReLU（带泄漏线性整流函数）"></a>LeakyReLU（带泄漏线性整流函数）</h3><p>LeakyReLU(z)=max(alpha*z, z)超参数alpha表示函数泄漏程度，时z&lt;0时的坡度，一般设为 0.01。</p>
<h3 id="ELU-加速线性单元"><a href="#ELU-加速线性单元" class="headerlink" title="ELU (加速线性单元)"></a>ELU (加速线性单元)</h3><p>ELU(z) = alpha(exp(z) -1) ,(z&lt;0)<br>ELU(z) = z, (z&gt;=0)<br>超参数alpha指当z是一个极小的负数时，ELU接近于-alpha，通常设置为1。对于z=0有非0梯度，整体很平滑。<br>计算速度比ReLU和它的变种慢，由于使用指数函数，但训练过程中可以更快收敛。<br>通常训练时间：ELU&gt;leaky ReLU&gt;ReLU&gt;tahn&gt;逻辑函数</p>
<ul>
<li><p>Leaky_relu实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def leaky_relu(z, name=None):</span><br><span class="line">    return tf.maximum(0.01*z, z, name=None)</span><br><span class="line"></span><br><span class="line">#[......]</span><br><span class="line"></span><br><span class="line">with tf.name_scope(&quot;dnn&quot;):</span><br><span class="line">    hidden1 = tf.layers.dense(X, n_hidden1, activation=leaky_relu, name=&quot;hidden1&quot;)</span><br><span class="line">    hidden2 = tf.layers.dense(hidden1,n_hidden2, activation=leaky_relu, name=&quot;hidden2&quot;)</span><br><span class="line">    logits = tf.layers.dense(hidden2, n_outputs, name=&quot;outputs&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>relu</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hidden1 = tf.layers.dense(X, n_hidden1, activation=tf.nn.relu, name=“hidden1”)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="批量归一化"><a href="#批量归一化" class="headerlink" title="批量归一化"></a>批量归一化</h2><p>在每一层激活函数之前在模型里加入一个操作，简单零中心化和归一化输入，之后再通过每层两个新参数缩放和移动结果，让模型学会了最佳规模和每层输入的平均值。<br>构建阶段使用tf.layers.batch_nomalization()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">reset_graph()</span><br><span class="line"></span><br><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">n_inputs = 28 * 28</span><br><span class="line">n_hidden1 = 300</span><br><span class="line">n_hidden2 = 100</span><br><span class="line">n_outputs = 10</span><br><span class="line"></span><br><span class="line">X = tf.placeholder(tf.float32, shape=(None, n_inputs), name=&quot;X&quot;)</span><br><span class="line"></span><br><span class="line">training = tf.placeholder_with_default(False, shape=(), name=&quot;training&quot;)#告诉模型时训练状态还是测试状态</span><br><span class="line"></span><br><span class="line">hidden1 = tf.layers.dense(X, n_hidden1, name=&quot;hidden1&quot;)</span><br><span class="line">bn1 = tf.layers.batch_normalization(hidden1, training=training, momentum=0.9)#中心化和归一化输入</span><br><span class="line">#衰变值momentum</span><br><span class="line">#用于更新平均值v = v✖️momentum + v✖️（1 - momentum）</span><br><span class="line"></span><br><span class="line">bn1_act = tf.nn.elu(bn1)</span><br><span class="line"></span><br><span class="line">hidden2 = tf.layers.dense(bn1_act, n_hidden2, name=&quot;hidden2&quot;)</span><br><span class="line">bn2 = tf.layers.batch_normalization(hidden2, training=training, momentum=0.9)</span><br><span class="line">bn2_act = tf.nn.elu(bn2)</span><br><span class="line"></span><br><span class="line">logits_before_bn = tf.layers.dense(bn2_act, n_outputs, name=&quot;outputs&quot;)</span><br><span class="line">logits = tf.layers.batch_normalization(logits_before_bn, training=training, momentum=0.9)</span><br></pre></td></tr></table></figure></p>
<p>简化构建用partial<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from functools import partial</span><br><span class="line"></span><br><span class="line">my_batch_norm_layer = partial(tf.layers.batch_normalization, training=training, momentum=0.9)</span><br><span class="line"></span><br><span class="line">hidden1 = tf.layers.dense(X, n_hidden1, name=&quot;hidden1&quot;)</span><br><span class="line">bn1 = my_batch_norm_layer(hidden1)</span><br><span class="line">bn1_act = tf.nn.elu(bn1)</span><br><span class="line">hidden2 = tf.layers.dense(X, n_hidden2, name=&quot;hidden2&quot;)</span><br><span class="line">bn2 = my_batch_norm_layer(hidden2)</span><br><span class="line">bn2_act = tf.nn.elu(bn2)</span><br><span class="line">logits_before_bn = tf.layers.dense(bn2_act, n_inputs, name=&quot;outputs&quot;)</span><br><span class="line">logits = my_batch_norm_layer(logits_before_bn)</span><br></pre></td></tr></table></figure></p>
<p>执行阶段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">n_epochs =20</span><br><span class="line">batch_size = 200</span><br><span class="line"></span><br><span class="line">#关键</span><br><span class="line">extra_update_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)</span><br><span class="line">#tf.GraphKeys.UPDATE_OPS是计算图内置的一个集合，保存一些需要在训练操作之前完成的操作，并配合tf.control_dependencies使用</span><br><span class="line">#tf.control_dependencies可以控制在执行前完成某些操作</span><br><span class="line">#此处即是在batch_norm中实现更新mean和variance的操作，这两个操作在tensorflow内部实现中被自动加入这个集合</span><br><span class="line"></span><br><span class="line">with tf.Session() as sess:</span><br><span class="line">    init.run()</span><br><span class="line">    for epoch in range(n_epochs):</span><br><span class="line">        for X_batch, y_batch in shuffle_batch(X_train, y_train, batch_size):</span><br><span class="line">            sess.run([training_op, extra_update_ops], feed_dict=&#123;training:True, X:X_batch ,y:y_batch&#125;)</span><br><span class="line">			#需告知training状态</span><br><span class="line">        accuracy_val = accuracy.eval(feed_dict=&#123;X:X_valid,y:y_valid&#125;)</span><br><span class="line">        print(epoch, &quot;Validation accuracy:&quot;, accuracy_val)</span><br><span class="line">    save_path = saver.save(sess, &quot;./model/my_model_final.ckpt&quot;)</span><br></pre></td></tr></table></figure></p>
<h2 id="梯度裁剪"><a href="#梯度裁剪" class="headerlink" title="梯度裁剪"></a>梯度裁剪</h2><p>在反向传播过程中裁剪梯度，从而保证不超过阈值。</p>
<p>构建阶段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">reset_graph()</span><br><span class="line"></span><br><span class="line">n_inputs = 28*28</span><br><span class="line">n_hidden1 = 300</span><br><span class="line">n_hidden2 = 50</span><br><span class="line">n_hidden3 = 50</span><br><span class="line">n_hidden4 = 50</span><br><span class="line">n_hidden5 = 50</span><br><span class="line">n_outputs = 10</span><br><span class="line"></span><br><span class="line">X = tf.placeholder(tf.float32, shape=(None, n_inputs), name=&quot;X&quot;)</span><br><span class="line">y = tf.placeholder(tf.int32, shape=(None), name=&quot;y&quot;)</span><br><span class="line"></span><br><span class="line">with tf.name_scope(&quot;dnn&quot;):</span><br><span class="line">    hidden1 = tf.layers.dense(X, n_hidden1, activation=tf.nn.relu, name=&quot;hidden1&quot;)</span><br><span class="line">    hidden2 = tf.layers.dense(hidden1, n_hidden2, activation=tf.nn.relu, name=&quot;hidden2&quot;)</span><br><span class="line">    hidden3 = tf.layers.dense(hidden2, n_hidden3, activation=tf.nn.relu, name=&quot;hidden3&quot;)</span><br><span class="line">    hidden4 = tf.layers.dense(hidden3, n_hidden4, activation=tf.nn.relu, name=&quot;hidden4&quot;)</span><br><span class="line">    hidden5 = tf.layers.dense(hidden4, n_hidden5, activation=tf.nn.relu, name=&quot;hidden5&quot;)</span><br><span class="line">    logits = tf.layers.dense(hidden5, n_outputs, name=&quot;outputs&quot;)</span><br><span class="line">    </span><br><span class="line">with tf.name_scope(&quot;loss&quot;):</span><br><span class="line">    xentropy = tf.nn.sparse_softmax_cross_entropy_with_logits(labels=y, logits=logits)</span><br><span class="line">    loss = tf.reduce_mean(xentropy, name=&quot;loss&quot;)</span><br></pre></td></tr></table></figure></p>
<p>构建阶段使用tf.clip_by_value<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#train部分关键</span><br><span class="line">threshold = 1.0</span><br><span class="line"></span><br><span class="line">optimizer = tf.train.GradientDescentOptimizer(learning_rate)</span><br><span class="line">grads_and_vars = optimizer.compute_gradients(loss)</span><br><span class="line">capped_gvs = [(tf.clip_by_value(grad, -threshold, threshold), var) for grad, var in grads_and_vars]</span><br><span class="line">training_op = optimizer.apply_gradients(capped_gvs)</span><br></pre></td></tr></table></figure></p>
<p>执行和前面相同</p>
<h1 id="重用预训练网络"><a href="#重用预训练网络" class="headerlink" title="重用预训练网络"></a>重用预训练网络</h1><p>提升训练速度，减少训练数据。</p>
<h3 id="重用模型的一部分"><a href="#重用模型的一部分" class="headerlink" title="重用模型的一部分"></a>重用模型的一部分</h3><ul>
<li><p>法1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">reset_graph()</span><br><span class="line"></span><br><span class="line">saver = tf.train.import_meta_graph(&quot;my_model_final.ckpt.meta&quot;)</span><br><span class="line"></span><br><span class="line">#打印operation</span><br><span class="line">for op in tf.get_default_graph().get_operations():</span><br><span class="line">    print(op.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X = tf.get_default_graph().get_tensor_by_name(&quot;X: 0&quot;)</span><br><span class="line">y = tf.get_default_graph().get_tensor_by_name(&quot;y: 0&quot;)</span><br><span class="line"></span><br><span class="line">accuracy = tf.get_default_graph().get_tensor_by_name(&quot;eval/accuracy:0&quot;)</span><br><span class="line"></span><br><span class="line">training_op = tf.get_default_graph().get_operation_by_name(&quot;train/GradientDescent&quot;)</span><br><span class="line"></span><br><span class="line">#执行阶段</span><br><span class="line">with tf.Session() as sess:</span><br><span class="line">    saver.restore(sess, &quot;./my_model_final.ckpt&quot;)</span><br><span class="line"></span><br><span class="line">    for epoch in range(n_epochs):</span><br><span class="line">        for X_batch, y_batch in shuffle_batch(X_train, y_train, batch_size):</span><br><span class="line">            sess.run(training_op, feed_dict=&#123;X: X_batch, y: y_batch&#125;)</span><br><span class="line">        accuracy_val = accuracy.eval(feed_dict=&#123;X: X_valid, y: y_valid&#125;)</span><br><span class="line">        print(epoch, &quot;Validation accuracy:&quot;, accuracy_val)</span><br><span class="line"></span><br><span class="line">    save_path = saver.save(sess, &quot;./my_new_model_final.ckpt&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>法2：配置Saver使之还原模型只还原所有参数的一个子集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">reuse_vars = tf.get_collection(tf.GraphKeys.GLOBAL_VARIABLES, scope=&quot;hidden[123]&quot;)#关键</span><br><span class="line"></span><br><span class="line">restore_saver = tf.train.Saver(reuse_vars)#to restore layers 123#关键</span><br><span class="line"></span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line">saver = tf.train.Saver()</span><br><span class="line"></span><br><span class="line">with tf.Session() as sess:</span><br><span class="line">    init.run()</span><br><span class="line">    restore_saver.restore(sess, &quot;./model/my_model_final.ckpt&quot;)#关键</span><br><span class="line">    </span><br><span class="line">    for epoch in range(n_epochs):</span><br><span class="line">        for X_batch, y_batch in shuffle_batch(X_train, y_train, batch_size):</span><br><span class="line">            sess.run(training_op, feed_dict=&#123;X:X_batch, y:y_batch&#125;)</span><br><span class="line">        accuracy_val = accuracy.eval(feed_dict=&#123;X:X_valid, y:y_valid&#125;)</span><br><span class="line">        print(epoch, &quot;Validation Accuracy:&quot;, accuracy_val)</span><br><span class="line">    </span><br><span class="line">    save_path = saver.save(sess, &quot;./my_new_model_final.ckpt&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="冻结低层"><a href="#冻结低层" class="headerlink" title="冻结低层"></a>冻结低层</h3><ul>
<li>法1<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">reset_graph()</span><br><span class="line"></span><br><span class="line">n_inputs = 28 * 28</span><br><span class="line">n_hidden1 = 300</span><br><span class="line">n_hidden2 = 50</span><br><span class="line">n_hidden3 = 50</span><br><span class="line">n_hidden4 = 20</span><br><span class="line">n_outputs = 10</span><br><span class="line"></span><br><span class="line">X = tf.placeholder(tf.float32, shape=(None, n_inputs), name=&quot;X&quot;)</span><br><span class="line">y = tf.placeholder(tf.int32, shape=(None), name=&quot;y&quot;)</span><br><span class="line"></span><br><span class="line">with tf.name_scope(&quot;dnn&quot;):</span><br><span class="line">    hidden1 = tf.layers.dense(X, n_hidden1, activation=tf.nn.relu, name=&quot;hidden1&quot;)</span><br><span class="line">    hidden2 = tf.layers.dense(hidden1, n_hidden2, activation=tf.nn.relu, name=&quot;hidden2&quot;)</span><br><span class="line">    hidden3 = tf.layers.dense(hidden2, n_hidden3, activation=tf.nn.relu, name=&quot;hidden3&quot;)</span><br><span class="line">    hidden4 = tf.layers.dense(hidden3, n_hidden4, activation=tf.nn.relu, name=&quot;hidden4&quot;)</span><br><span class="line">    logits = tf.layers.dense(hidden4, n_outputs, name=&quot;outputs&quot;)</span><br><span class="line">    </span><br><span class="line">with tf.name_scope(&quot;loss&quot;):</span><br><span class="line">    xentropy = tf.nn.sparse_softmax_cross_entropy_with_logits(labels=y, logits=logits)</span><br><span class="line">    loss = tf.reduce_mean(xentropy, name=&quot;loss&quot;)</span><br><span class="line">    </span><br><span class="line">with tf.name_scope(&quot;eval&quot;):</span><br><span class="line">    correct = tf.nn.in_top_k(logits, y, 1)</span><br><span class="line">    accuracy = tf.reduce_mean(tf.cast(correct, tf.float32), name=&quot;accuracy&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>设置训练器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">with tf.name_scope(&quot;train&quot;):</span><br><span class="line">    optimizer = tf.train.GradientDescentOptimizer(learning_rate)</span><br><span class="line">    train_vars = tf.get_collection(tf.GraphKeys.TRAINABLE_VARIABLES, scope=&quot;hidden[34]|outputs&quot;)</span><br><span class="line">    </span><br><span class="line">    training_op = optimizer.minimize(loss, var_list=train_vars)</span><br></pre></td></tr></table></figure></p>
<p>设置Saver<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">reuse_vars = tf.get_collection(tf.GraphKeys.GLOBAL_VARIABLES, scope=&quot;hidden[123]&quot;)</span><br><span class="line">restore_saver = tf.train.Saver(reuse_vars)</span><br><span class="line"></span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line">saver = tf.train.Saver()</span><br></pre></td></tr></table></figure></p>
<p>执行阶段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">with tf.Session() as sess:</span><br><span class="line">    init.run()</span><br><span class="line">    restore_saver.restore(sess, &quot;./model/my_model_final.ckpt&quot;)</span><br><span class="line">    </span><br><span class="line">    for epoch in range(n_epochs):</span><br><span class="line">        for X_batch, y_batch in shuffle_batch(X_train, y_train, batch_size):</span><br><span class="line">            sess.run(training_op, feed_dict=&#123;X:X_batch, y:y_batch&#125;)</span><br><span class="line">            accuracy_val = accuracy.eval(feed_dict=&#123;X:X_valid, y:y_valid&#125;)</span><br><span class="line">        print(epoch, &quot;Validation Accuracy:&quot;, accuracy_val)</span><br><span class="line">    </span><br><span class="line">    save_path = saver.save(sess, &quot;./my_new_model_final.ckpt&quot;)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>法2<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">with tf.name_scope(&quot;dnn&quot;):</span><br><span class="line">    hidden1 = tf.layers.dense(X, n_hidden1, activation=tf.nn.relu, name=&quot;hidden1&quot;)</span><br><span class="line">    hidden2 = tf.layers.dense(hidden1, n_hidden2, activation=tf.nn.relu, name=&quot;hidden2&quot;)</span><br><span class="line">    hidden2_stop = tf.stop_gradient(hidden2)#设置不更新权重</span><br><span class="line">    hidden3 = tf.layers.dense(hidden2_stop, n_hidden3, activation=tf.nn.relu, name=&quot;hidden3&quot;)</span><br><span class="line">    hidden4 = tf.layers.dense(hidden3, n_hidden4, activation=tf.nn.relu, name=&quot;hidden4&quot;)</span><br><span class="line">    logits = tf.layers.dense(hidden4, n_outputs, name=&quot;outputs&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>其他正常设置</p>
<ul>
<li>缓存冻结层<br>因为冻结层不发生变化，所以可以将训练实例的最高冻结层输出缓存起来，由于之前训练会轮询数据集很多次，缓存冻结层将整个数据集先通过冻结层输出后，构建新的输出，可以获得巨大速度提升。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># caching the Frozen Layers</span><br><span class="line"></span><br><span class="line">reset_graph()</span><br><span class="line"></span><br><span class="line">n_inputs = 28 * 28</span><br><span class="line">n_hidden1 = 300</span><br><span class="line">n_hidden2 = 50</span><br><span class="line">n_hidden3 = 50</span><br><span class="line">n_hidden4 = 20</span><br><span class="line">n_outputs = 10</span><br><span class="line"></span><br><span class="line">X = tf.placeholder(tf.float32, shape=(None, n_inputs), name=&quot;X&quot;)</span><br><span class="line">y = tf.placeholder(tf.int32, shape=(None), name=&quot;y&quot;)</span><br><span class="line"></span><br><span class="line">with tf.name_scope(&quot;dnn&quot;):</span><br><span class="line">    hidden1 = tf.layers.dense(X, n_hidden1, activation=tf.nn.relu, name=&quot;hidden1&quot;)</span><br><span class="line">    hidden2 = tf.layers.dense(hidden1, n_hidden2, activation=tf.nn.relu, name=&quot;hidden2&quot;)</span><br><span class="line">    hidden2_stop = tf.stop_gradient(hidden2) #冻结层</span><br><span class="line">    hidden3 = tf.layers.dense(hidden2_stop, n_hidden3, activation=tf.nn.relu, name=&quot;hidden3&quot;)</span><br><span class="line">    hidden4 = tf.layers.dense(hidden3, n_hidden4, activation=tf.nn.relu, name=&quot;hidden4&quot;)</span><br><span class="line">    logits = tf.layers.dense(hidden4, n_outputs, name=&quot;outputs&quot;)</span><br><span class="line">    </span><br><span class="line">with tf.name_scope(&quot;loss&quot;):</span><br><span class="line">    xentropy = tf.nn.sparse_softmax_cross_entropy_with_logits(labels=y, logits=logits)</span><br><span class="line">    loss = tf.reduce_mean(xentropy)</span><br><span class="line">    </span><br><span class="line">with tf.name_scope(&quot;eval&quot;):</span><br><span class="line">    correct = tf.nn.in_top_k(logits, y, 1)</span><br><span class="line">    accuracy = tf.reduce_mean(tf.cast(correct, tf.float32), name=&quot;accuracy&quot;)</span><br><span class="line"></span><br><span class="line">with tf.name_scope(&quot;train&quot;):</span><br><span class="line">    optimizer = tf.train.GradientDescentOptimizer(learning_rate)</span><br><span class="line">    training_op = optimizer.minimize(loss)</span><br><span class="line"></span><br><span class="line">#重用部分层</span><br><span class="line">reuse_vars = tf.get_collection(tf.GraphKeys.GLOBAL_VARIABLES, scope=&quot;hidden[123]&quot;)</span><br><span class="line">restore_saver = tf.train.Saver(reuse_vars)</span><br><span class="line"></span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line">saver = tf.train.Saver()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">n_batches = len(X_train) // batch_size</span><br><span class="line"></span><br><span class="line">with tf.Session() as sess:</span><br><span class="line">    init.run()</span><br><span class="line">    </span><br><span class="line">    restore_saver.restore(sess, &quot;./model/my_model_final.ckpt&quot;)</span><br><span class="line">    </span><br><span class="line">    #在低层跑完整个训练集</span><br><span class="line">    h2_cache = sess.run(hidden2, feed_dict=&#123;X:X_train&#125;)</span><br><span class="line">    h2_cache_valid = sess.run(hidden2, feed_dict=&#123;X:X_valid&#125;)</span><br><span class="line">    </span><br><span class="line">    #构建hidden2的输出，并进行训练</span><br><span class="line">    for epoch in range(n_epochs):</span><br><span class="line">        shuffled_idx = np.random.permutation(len(X_train))</span><br><span class="line">        hidden2_batches = np.array_split(h2_cache[shuffled_idx], n_batches)</span><br><span class="line">        y_batches = np.array_split(y_train[shuffled_idx], n_batches)</span><br><span class="line">        for hidden2_batch, y_batch in zip(hidden2_batches, y_batches):</span><br><span class="line">            sess.run(training_op, feed_dict=&#123;hidden2:hidden2_batch, y:y_batch&#125;)</span><br><span class="line">        accuracy_val = accuracy.eval(feed_dict=&#123;hidden2: h2_cache_valid, y: y_valid&#125;)</span><br><span class="line">        </span><br><span class="line">        print(epoch, &quot;Validation accuracy:&quot;, accuracy_val)</span><br><span class="line">        </span><br><span class="line">    save_path = saver.save(sess, &quot;./my_new_model_final.ckpt&quot;)</span><br></pre></td></tr></table></figure><p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/06/EF6E429A-DD75-410E-BA1C-D2155AE088CB/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/06/C9585905-3174-49F4-91CB-49EEAFBA8BEC/">sklearn实现支持向量机</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-06 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/机器学习/">机器学习</a></span>
      <p></p><h1 id="支持向量机"><a href="#支持向量机" class="headerlink" title="支持向量机"></a>支持向量机</h1><ol>
<li>线性SVM分类</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.preprocessing import StandardScaler</span><br><span class="line">from sklearn.svm import LinearSVC</span><br><span class="line">svm_clf = Pipeline((</span><br><span class="line">		(“scaler”, StandardScaler()),</span><br><span class="line">		(“linear_svc”, LinearSVC(C=1, loss=“hinge”))</span><br><span class="line">))</span><br><span class="line">svm_clf.fit(X, y)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>非线性SVM分类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.preprocessing import PolynomialFeatures</span><br><span class="line">Polynomial_svm_clf = Pipeline((</span><br><span class="line">		(“poly_fetures”, PolynomialFeatures(degree=3)),</span><br><span class="line">		((“scaler”,    ),</span><br><span class="line">		((“svm_clf”,  LinearSVC(C=10, loss=“hinge”))</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
</li>
<li><p>多项式核</p>
</li>
</ol>
<ul>
<li>核技巧<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.svm import SVC</span><br><span class="line">Poly_kernel_svm_clf = Pipeline((</span><br><span class="line">		(“scaler”,    ),</span><br><span class="line">		(“svm_clf”, SVC(kernel=“poly”, degree=3, coef0=1, C=5))</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>上面使用了3阶多项式核的SVM分类器。<br>如果模型过度拟合，应降低多项式阶数，反之提升阶数。<br>超参数coef0控制模型首高阶还是低阶多项式影响的程度。</p>
<hr>
<p>寻找正确超参数值的常用方法是网格搜索。</p>
<hr>
<ul>
<li>添加相似特征<br>高斯径向积函数RBF，通过创建地标，构建新特征，使不可分问题线性可分。（公式P204）</li>
<li>选择地标的方法： 在数据集每个实例位置创建一个地标，变成一个m✖️m的训练集</li>
<li>高斯RBF核函数：产生的结果和添加很多相似特征一样，实际上没添加<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Rbf_kernel_svm_clf = Pipeline((</span><br><span class="line">		(“scaler”, StandardScaler()),</span><br><span class="line">		(“svm_clf”, SVC(kernel=”rbf”, gamma=5, C=0.001))</span><br><span class="line">))</span><br><span class="line">``` </span><br><span class="line">gamma值会使钟形曲线变窄，每个实例影响范围缩小：决策边界不规则，围绕单个实例旋转。</span><br><span class="line">减少gamma会使曲线变得更宽，每个实例影响范围更大，决策边界更平坦。</span><br><span class="line">（类似超参数C）</span><br><span class="line"></span><br><span class="line">&gt; 永远先从线性核函数开始尝试，LinearSVC比SVC（kernel=“linear”）快得多。  </span><br><span class="line">&gt; 使用交叉验证，网格搜索来尝试其他核函数。  </span><br><span class="line"></span><br><span class="line">* 计算复杂度的比较（p207）</span><br><span class="line">SVC支持核技巧，其他都不支持，但是时间复杂度很高。</span><br><span class="line">3. SVM回归</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>From sklearn.svm import LinearSVR</p>
<p>Svm_reg = LinearSVR(epsilon=1.5)#epsilon “街道”的宽度<br>Svm_reg.fit(X, y)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">使用SVR类（支持核技巧）</span><br></pre></td></tr></table></figure></p>
<p>From sklearn.svm import SVR<br>Svm_poly_reg = SVR(kernel=“poly”, C=100, eplison=0.1)<br>Svm_poly_reg.fit()<br><code>`</code></p>
<blockquote>
<p>超参数C是松弛变量的系数，用于权衡特征权重W和松弛变量的关系，增大C，会增强对松弛变量的优化，从而使允许违例程度减少，决策边界不规则  </p>
</blockquote>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/06/C9585905-3174-49F4-91CB-49EEAFBA8BEC/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/06/221B146F-F963-4421-A711-CA2215884E08/">sklearn实现决策树</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-06 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/机器学习/">机器学习</a></span>
      <p></p><h1 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h1><ol>
<li>训练与可视化 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.tree import DecsionTreeClassifier</span><br><span class="line"></span><br><span class="line">Tree_clf = DecisionTreeClassifer(max_depth=2)</span><br><span class="line">Tree_clf.fit()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.tree import export_graphviz</span><br><span class="line"></span><br><span class="line">Export_graphviz(</span><br><span class="line">		tree_clf,</span><br><span class="line">		out_file=‘iris_tree.dot’,</span><br><span class="line">		feature_names=iris.feature_names[2:],</span><br><span class="line">		class_names=iris.target_names,</span><br><span class="line">		rounded=True,</span><br><span class="line">		filled=True</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>使用graphviz包中的dot命令行工具进行转化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dot -Tpng iris_tree.dot -o iris_tree.png</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>作出预测<blockquote>
<p>Scikit-learn使用的是CART算法，只生成二叉树，非叶节点只有两个子节点。<br>其他算法如ID3可拥有两个以上子节点。  </p>
</blockquote>
</li>
<li><p>估算类别概率<br>该节点中类别k的训练实例占比</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tree_clf.predict_proba([[5, 1.5]])</span><br></pre></td></tr></table></figure>
</li>
<li><p>CART算法 分类与回归树<br>使用单个特征k和阈值t_k将训练集分成两个子集。<br>最小化成本函数，两侧不纯度的加权之和。（公式p230）<br>是一种贪婪算法，最后的解相当不错，但不保证最优。</p>
</li>
<li><p>计算复杂度<br>预测复杂度 logm/log2<br>训练复杂度n✖️mlogm<br>可以设置presot=True对数据预处理加快训练</p>
</li>
<li>选择基尼不纯度还是信息熵<br>默认使用基尼不纯度，超参数criterion设置为entropy选择信息熵。<br>大多情况区别不大，集你不纯度倾向分裂最常见类别，信息熵趋向于产生平衡的树。</li>
<li>正则化超参数<br>避免过拟合，降低自由度。<br>限制深度，max_depth<br>分裂前节点必须有的最小样本数：min_samples_split<br>叶节点必须有的最小样本数：min_samples_leaf<br>加权实例总数的占比：min_weigjt_fraction_leaf<br>最大叶节点数：max_leaf_nodes<br>分裂每个节点评估的最大特征数量max_feature</li>
<li>回归<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.tree import DecisionTreeRegressor</span><br><span class="line">Tree_reg = DecisionTreeRegressor(max_depth)</span><br><span class="line">Tree_reg.fit()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>分裂训练集的方式为最小化MSE<br>成本函数，左右两侧mse加权之和（p237）</p>
<ol start="9">
<li>不稳定性<br>青睐正交垂直边界，可能导致泛化不佳，可用PCA来限制这一问题。<br>随即森林可限制这一不稳定性。</li>
</ol>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/06/221B146F-F963-4421-A711-CA2215884E08/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/06/B5B2671B-F4D2-4A63-A861-775CE5E0CA85/">sklearn实现降维</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-06 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/机器学习/">机器学习</a></span>
      <p></p><h1 id="降维"><a href="#降维" class="headerlink" title="降维"></a>降维</h1><blockquote>
<p>能够加速训练，但会轻微降低系统性能，使流水线更加复杂，维护难度上升。<br>高维空间数据集很大可能是非常稀疏的。 训练集维度越高，过拟合风险就越大。</p>
<ol>
<li>数据降维的主要方法</li>
</ol>
<ul>
<li>投影</li>
</ul>
</blockquote>
<ul>
<li>流形学习<br>对训练实例进行流形建模。<br>2D流形就是一个能够在更高维空间里弯曲和扭转的2D形状。<br>d维流形就是n（d&lt;n）维空间的一部分，局部类似于一个d维超平面。<blockquote>
<p>在训练模型前降低训练集的维度，肯定可以加快训练速度，但这并不总会导致更好或更简单的解决方案，它取决于数据集。  </p>
</blockquote>
</li>
</ul>
<ol start="2">
<li>PCA<br>识别出最接近数据的超平面，然后将数据投影其上。</li>
</ol>
<ul>
<li><p>保留差异性<br>识别哪条轴对差异性贡献最高，与第一条轴垂直的轴对剩余差异性贡献最高。<br>奇异值分解（svd）可用于寻找主成分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X_centered = X - X.mean(axis=0)</span><br><span class="line">U, s, V = np.linalg.svd(X_centered)</span><br><span class="line">C1 = V.T[:,0]</span><br><span class="line">C2 = V.T[:,1]</span><br></pre></td></tr></table></figure>
</li>
<li><p>低维度投影<br>X_d-prom =X点乘W_d</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">W2 = V.T[:,:2]</span><br><span class="line">X2D = X_centered.dot(W2)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用Scikit-Learn</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#pca类借助SVD分解实现主成分分析</span><br><span class="line">From sklearn.decoposition import PCA</span><br><span class="line">PCA = PCA(n_components = 2)</span><br><span class="line">X2D = PCA.fit_transform(X)</span><br></pre></td></tr></table></figure>
</li>
<li><p>方差解释率<br>表示每个主成分轴对整个数据集的方差的贡献度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Print(PCA.explained_variance_ratio_)</span><br></pre></td></tr></table></figure>
</li>
<li><p>选择正确数量的维数<br>法1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pca = PCA()</span><br><span class="line">Pca.fit(X)</span><br><span class="line">Cumsum = np.cumsum(pca.explained_variance_ratio_)</span><br><span class="line">d = np.argmax(cumsum &gt;= 0.95) + 1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>法2：直接设置保留的方差比<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pca = PCA(n_components=0.95)</span><br><span class="line">X_reduced = pca.fit_transform(X)</span><br></pre></td></tr></table></figure></p>
<p>法3：绘制cumsum，找到曲线拐点</p>
<ul>
<li>PCA压缩<br>原始数据和重建数据（压缩之后解压缩）之间的均方距离，被称为<strong>重建误差</strong>。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pca = PCA(n_components = 154)</span><br><span class="line">X_mnist_reduced = pca.fit_transform(X_mnist)</span><br><span class="line">X_mnist_recovered = pca.inverse_transform(X_mnist_reduced)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>X_recovered = X_d-project 点乘 W_d.T</p>
<ul>
<li>增量PCA<br>将训练集分成一个个小批量，一次给IPCA算法喂一个。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.decomposition import incrementalPCA</span><br><span class="line">N_batches = 100</span><br><span class="line">Inc_pca = IncrementalPCA(n_component=154)</span><br><span class="line">For x_batch in np.array_split(X_mnist, n_batches):</span><br><span class="line">		inc_pca.partial_fit(X_batch)</span><br><span class="line">X_mnist_reduced = inc_pca.transform(X_mnist)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>使用numpy的memmap类，仅在需要时加载内存中需要的数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">X_mm = np.memmap(filename, dtype=“float32”, mode=“readonly”, shape=(m,n))</span><br><span class="line"></span><br><span class="line">Batch_size = m // n_batches</span><br><span class="line">Inc_pca = IncrementalPCA(n_components=154, 				</span><br><span class="line">batch_size=batch_size)</span><br><span class="line">Inc_pca.fit(X_mm)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>随机PCA<br>快速找到主成分的近似值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rnd_pca = PCA(n_components=154, svd_solver=“randomized”)</span><br><span class="line">X_reduced =rnd_pca.fit_transform(X_mnist)</span><br></pre></td></tr></table></figure>
</li>
<li><p>核主成分分析<br>核技巧，隐形地将实例映射到高维特征空间，使支持向量机能进行非线性分类和回归。</p>
</li>
</ul>
<p>可应用于PCA<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.decomposition import KernelPCA</span><br><span class="line"></span><br><span class="line">Rbf_pca = KernelPCA(n_components=2, kernel=“rbf”, gamma=0.04)</span><br><span class="line">X_reduced = rbf_pca.fit_transform(X)</span><br></pre></td></tr></table></figure></p>
<p>选择核函数核调整超参数</p>
<blockquote>
<p>由于kPCA是一种无监督学习方法，没有明显的性能指标来帮助选择最佳核函数核超参数值。 而降维通常是监督学习的准备步骤，所以可以使用网格搜索，来找到使任务性能最佳的核和超参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.model_selection import GridSearchCV</span><br><span class="line">from sklearn.linear_model import LogisticRegression</span><br><span class="line">from sklearn.pipeline import Pipeline</span><br><span class="line"></span><br><span class="line">clf = Pipeline([</span><br><span class="line">        (&quot;kpca&quot;, KernelPCA(n_components=2)),</span><br><span class="line">        (&quot;log_reg&quot;, LogisticRegression(solver=&quot;liblinear&quot;))</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">param_grid = [&#123;</span><br><span class="line">        &quot;kpca__gamma&quot;: np.linspace(0.03, 0.05, 10),</span><br><span class="line">        &quot;kpca__kernel&quot;: [&quot;rbf&quot;, &quot;sigmoid&quot;]</span><br><span class="line">    &#125;]</span><br><span class="line"></span><br><span class="line">grid_search = GridSearchCV(clf, param_grid, cv=3)</span><br><span class="line">grid_search.fit(X, y)</span><br><span class="line"></span><br><span class="line">Print(grid_search.best_params_)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>法2：选择重建误差最低的核和超参数，但是因为映射维度问题实现不容易。<br>可在原始空间找一点，使其映射于重建点，这被称为重建原像。<br>通过设置fit_inverse_transform=True实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rbf_pca = KernelPCA(n_component=2, kernel=“rbf”, gamma=0.0443,</span><br><span class="line">	fit_inverse_transform=True)</span><br><span class="line">X_reduced = rbf_pca.fit_transform(X)</span><br><span class="line">X_preimage = rbf_pca.inverse_transform(X_reduced)</span><br></pre></td></tr></table></figure></p>
<p>计算重建原像误差。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.metrics import mean_squared_error</span><br><span class="line"></span><br><span class="line">mean_squared_error(X, X_preimage)</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>局部线性嵌入（LLE） 另一种非线性降维（NLDR）技术<br>一种流形学习技术。<br>LLE首先测量每个算法如何与其最近的邻居线性相关，然后寻找一个能最大程度保留这些局部关系的低维表示。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.manifold import LocallyLinearEmbedding</span><br><span class="line"></span><br><span class="line">Lyle = locallyLinearEmbedding(n_components=2, n_neighbors=10)</span><br><span class="line">X_reduced = ole.fit_transform(X)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>公式（P293）</p>
<ol start="4">
<li>其他降维技巧<br>MDS、 Isomap、 t-SNE、 LDA<br><img src="%E9%99%8D%E7%BB%B4/IMG_0016.PNG" alt></li>
</ol>
<p><img src="%E9%99%8D%E7%BB%B4/IMG_0017.PNG" alt></p>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/06/B5B2671B-F4D2-4A63-A861-775CE5E0CA85/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/06/203B2692-33BD-423D-A525-C3406A10F6B5/">sklearn集成学习和随机森林</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-06 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/机器学习/">机器学习</a></span>
      <p></p><h1 id="集成学习和随机森林"><a href="#集成学习和随机森林" class="headerlink" title="集成学习和随机森林"></a>集成学习和随机森林</h1><ol>
<li>投票分类器<blockquote>
<p>当预测器尽可能相互独立时，集成方法的效果最优。<br>获得更多种分类器的方法之一就是使用不同的算法进行训练。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.ensemble import RandomForestClassifier</span><br><span class="line">From sklearn.ensemble import RandomForestClassifier</span><br><span class="line">From sklearn.linear_model import LogisticRegression</span><br><span class="line">From sklearn.svm import SVC</span><br><span class="line"></span><br><span class="line">Log_clf=</span><br><span class="line">Rnd_clf=</span><br><span class="line">Svm_clf=</span><br><span class="line">Voting_clf=VotingClassifier(</span><br><span class="line">		estimators=[(‘lr’, log_clf),(‘rf’,rnf_clf),(‘svc’,svm_clf)],</span><br><span class="line">		voting=‘hard</span><br><span class="line">)</span><br><span class="line">Voting_clf.fit(X_train, y_train)</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ol>
<p>软投票法：当所有分类器都可以估算类别的概率（有predict_proba方法），可以将概率在所有当个分类器上平均，给出平均概率最高的类别作为预测，这被称为软投票法。通常比硬投票法更优。通过设置超参数voting=‘soft’完成。</p>
<blockquote>
<p>默认情况下SVC类没有predict_proba，需要设置超参数probabil=True。  </p>
</blockquote>
<ol start="2">
<li>bagging 和 pasting<br>每个预测集使用的算法相同，但在不同的训练集随机子集上进行训练。<br>bagging采样时将样本放回，pasting采样时样本不放回（bootstrap=False）</li>
</ol>
<p>与直接在原始训练集上训练单个预测器相比，集成的偏差相近，但方差更低。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.ensemble import BaggingClassifier</span><br><span class="line">From sklearn.tree import DecisionTreeClassifier</span><br><span class="line"></span><br><span class="line">Bag_clf = BaggingClassifier(</span><br><span class="line">		DecisionTreeClassifier(), n_estimators=500,</span><br><span class="line">		max_samples=100, bootstrap=True, n_jobs=-1</span><br><span class="line">)</span><br><span class="line">Bag_clf.fit()</span><br><span class="line">Y_pred = Bag_clf.predict(X_test)</span><br></pre></td></tr></table></figure></p>
<p>如果基础分类器能估算类别概率，具备predict_proba()，那么BaggingClassifier自动执行的就是软投票法而不是硬投票法。</p>
<p>自助法给每个训练子集引入了更高的多样性，所以bagging比pasting偏差略高，但预测器之间的关联度更低，集成方差降低。bagging生成的模型通常更好。</p>
<ul>
<li>包外评估<br>使用bagging时有些实例可能根本不会被采样。<br>用这些实例进行评估，将每个预测器在其包外实例上的评估结果进行平均，就可以得到集成的评估。<br>通过设置oob_score=True来实现训练结束后自动包外评估。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bag_clf = BaggingClassifier(</span><br><span class="line">		DecisionTreeClassifier(), n_estimators=500,</span><br><span class="line">		botstrap=True, n_jobs=-1, oob_score=True</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在测试集评估模型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.metrics import accuracy_score</span><br><span class="line">Y_pred= bag_clf.predict(X_test)</span><br><span class="line">accuracy_score(y_test, y_pred)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#获得每个训练实例的包外决策函数，本例中基础决策器有predict_proba()所以返回每个实例的类别概率</span><br><span class="line">Bag_clf.oob_decision_funtion_</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Random Patches 和随机子空间<br>BaggingClassifier也支持对特征进行抽样，通过超参数max_features和bootstrap_features控制，工作方式与实例抽样相同，只是对象时特征。</li>
</ol>
<p>对于处理高位输入特别有用（如图像）。<br>对训练实例和特征都进行抽样称为<strong>Random Patches</strong>方法。<br>保留所有训练实例（bootstrap=False且max_samples=1.0）但是对特征进行抽样(bootstrap_features=True且/或max_features&lt;1.0)，被称为<strong>随机子空间</strong>法。</p>
<p>对特征抽样给预测器带来更大多样性，得到更高偏差和更低方差。</p>
<ol start="4">
<li>随机森林<br>是决策树的集成，通常用bagging训练，训练集大小通过max_samples设置。<br>两种实现方法：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.ensemble import RandomForestClassifer</span><br><span class="line"></span><br><span class="line">Rnd_clf = RandomForestCLassifier(n_estimators=500, max_leaf_nodes=16, n_jobs=-1)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Bag_clf = BaggingClassifier(</span><br><span class="line">		DecisionTreeClassifier(splitter=“random”, max_leaf_nodes=16),</span><br><span class="line">		n_estimators=500, </span><br><span class="line">		max_samples=1.0, </span><br><span class="line">		bootstrap=True, </span><br><span class="line">		n_jobs=-1</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>极端随机树<br>节点分裂时，每个特征使用随机阈值，而不是搜索得出的最佳阈值。<br>这种极端随机的决策树组成的森林被称为极端随机树。<br>高偏差换取低方差。<br>通过ExtraTreesClasifier创建，API与RandomForestClassifier相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.ensemble import ExtraTreesClassifier</span><br><span class="line">Ext_clf = ExtraTreesClassifier(n_estimators=500, max_leaf_nodes=16, n_jobs=-1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>特征重要性<br>重要特征更可能出现在根节点位置。<br>通过计算一个特征早森林中所有树上的平均深度可以估算一个特征的重要程度。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">For name,score in zip(iris[“feature_names”),rnd_clf.feature_importances_):</span><br><span class="line">		print(name, score)</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>提升法（Boosting）<br>指将几个弱学习器结合成一个强学习器的任意集成方法。</li>
</ol>
<ul>
<li>AdaBoost<br>新预测器对其前序进行纠正的办法之一，更多关注前序拟合不足的实例。<br>无法并行，每个预测器要在前一个预测器训练评估后才能开始训练。<br>每个实例赋予初始权重，预测器依据加权误差率计算预测器权重，更新实例的权重，归一化所有实例权重，然后训练新的预测器。</li>
</ul>
<p>预测时计算预测器的预测结果，并通过权重加权，得到大多数加权投票的类别为预测类别。</p>
<blockquote>
<p>Sick it-learn使用的是Adaboost的一个多分类版本，叫SAMME（基于多类指数损失函数的逐步添加模型），只有两个类别时，SAMME等同于AdaBoost。<br>此外，预测器可以估算类别概率时，sklearn会使用SAMME的变体，称为SAMME.R，依赖的是类别概率而不是类别预测，通常表现更好。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.ensemble import AdaBoostClassifier</span><br><span class="line"></span><br><span class="line">Ada_clf = AdaBoostClassifer(</span><br><span class="line">		DecisionTreeClassifier(max_depth=1, n_estimators=200,</span><br><span class="line">			algorithm=“SAMME.R”, learning_rate=0.5</span><br><span class="line">		)</span><br><span class="line">		#学习率影响误分类实例的重视程度</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li>梯度提升Gradient Boosting<br>让新的预测器针对前一个预测器的残差进行拟合，各预测器预测结果相加得出最后预测结果。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.ensemble import GradientBoostingRegressor</span><br><span class="line"></span><br><span class="line">Gbrt = GradientBoostingRegressor(max_depth=2, n_estimators=3, learning_rate=1.0)</span><br><span class="line">#learning_rate对咩个数的贡献进行缩放。</span><br><span class="line">#如果设为低值，如0.1，则需要更多树来拟合训练集，但时预测繁华效果通常更好。</span><br></pre></td></tr></table></figure>
<p>找到最佳的树的数量可使用<strong>早期停止法</strong>。</p>
<blockquote>
<p>简单的实现方法使用<strong>staged_predict()</strong>方法：在训练每个阶段都对集成的预测返回一个迭代器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Gbrt = GradientBoostingRegressor(max_depth=2, n_estimator=120)</span><br><span class="line">Gbrt.fit(X_train, y_train)</span><br><span class="line">Errors = [mean_squared_error(y_val, y_pred)</span><br><span class="line">			for y_pred in gbrt.staged_predict(X_val)]</span><br><span class="line">Bst_n_estimators = np.argmin(errors)</span><br><span class="line">Gbrt_best = GradientBoostingRegressor(max_depth=2, n_estimators=bst_n_estimator)</span><br><span class="line">Gbrt_best.fit(X_train, y_train)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>设置<strong>warm_start=True</strong>,当fit()被调用时，Scikit-learn会保留现在树，从而允许增量训练。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">gbrt = GradientBoostingRegressor(max_depth=2, warm_start=True)</span><br><span class="line"></span><br><span class="line">min_val_error = float(&quot;inf&quot;)</span><br><span class="line">error_going_up = 0 </span><br><span class="line">for n_estimators in range(1,120):</span><br><span class="line">    gbrt.n_estimators =n_estimators</span><br><span class="line">    gbrt.fit(X_train, y_train)</span><br><span class="line">    y_pred = gbrt.predict(X_val)</span><br><span class="line">    val_error = mean_squared_error(y_val, y_pred)</span><br><span class="line">    if val_error &lt; min_val_error:</span><br><span class="line">        min_val_error = val_error</span><br><span class="line">        error_going_up = 0</span><br><span class="line">    else:</span><br><span class="line">        error_going_up += 1</span><br><span class="line">			#连续5次未改善时停止训练</span><br><span class="line">        if error_going_up == 5:</span><br><span class="line">            print(n_estimators-5)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ol start="6">
<li>堆叠法（stacking）<br>训练一个模型来执行对所有预测器的聚合<br>混合器将预测器的输出作为输入训练集，进行最终预测。<br>Scikit-learn不直接支持堆叠。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.ensemble import RandomForestClassifier, ExtraTreesClassifier</span><br><span class="line">from sklearn.svm import LinearSVC</span><br><span class="line">from sklearn.neural_network import MLPClassifier</span><br><span class="line"></span><br><span class="line">random_forest_clf = RandomForestClassifier(n_estimators=10, random_state=42)</span><br><span class="line">extra_trees_clf = ExtraTreesClassifier(n_estimators=10, random_state=42)</span><br><span class="line">svm_clf = LinearSVC(random_state=42)</span><br><span class="line">mlp_clf = MLPClassifier(random_state=42)</span><br><span class="line"></span><br><span class="line">#第一层预测器训练</span><br><span class="line">estimators = [random_forest_clf, extra_trees_clf, svm_clf, mlp_clf]</span><br><span class="line">for estimator in estimators:</span><br><span class="line">    print(&quot;Training the&quot;, estimator)</span><br><span class="line">    estimator.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">#第一层预测器形成训练集</span><br><span class="line">X_val_predictions = np.empty((len(X_val), len(estimators)), dtype=np.float32)</span><br><span class="line"></span><br><span class="line">for index, estimator in enumerate(estimators):</span><br><span class="line">    X_val_predictions[:, index] = estimator.predict(X_val)</span><br><span class="line"></span><br><span class="line">#训练混合器</span><br><span class="line">rnd_forest_blender = RandomForestClassifier(n_estimators=200, oob_score=True, random_state=42)</span><br><span class="line">rnd_forest_blender.fit(X_val_predictions, y_val)</span><br><span class="line"></span><br><span class="line">#生成测试集</span><br><span class="line">X_test_predictions = np.empty((len(X_test), len(estimators)), dtype=np.float32)</span><br><span class="line"></span><br><span class="line">for index, estimator in enumerate(estimators):</span><br><span class="line">    X_test_predictions[:, index] = estimator.predict(X_test)</span><br><span class="line"></span><br><span class="line">#预测</span><br><span class="line">y_pred = rnd_forest_blender.predict(X_test_predictions)</span><br><span class="line"></span><br><span class="line">#评估</span><br><span class="line">from sklearn.metrics import accuracy_score</span><br><span class="line">accuracy_score(y_test, y_pred)</span><br></pre></td></tr></table></figure></li>
</ol>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/06/203B2692-33BD-423D-A525-C3406A10F6B5/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/mengxiao2000.github.io/2019/11/06/A8E255A0-8354-4CBC-A3C9-37F780898882/">ANN简介基于TensorFlow</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2019-11-06 | <i class="fa fa-folder-o"></i> <a class="category-link" href="/mengxiao2000.github.io/categories/深度学习/">深度学习</a></span>
      <p></p><h1 id="ANN简介基于TensorFlow"><a href="#ANN简介基于TensorFlow" class="headerlink" title="ANN简介基于TensorFlow"></a>ANN简介基于TensorFlow</h1><h2 id="感知器"><a href="#感知器" class="headerlink" title="感知器"></a>感知器</h2><p>基于被称为基于线性阈值单元（LTU）的人工神经元：输入输出都是数字，每个输入连接对应一个权重，LTU加权求和所有输入，然后对求值结果应用于哥阶跃函数并产生最后的输出。</p>
<ul>
<li>Heavisider阶跃函数</li>
<li>Hebbian学习：当两个神经元有相同输出时，他们间的连接权重就会被增强。</li>
<li><p>Scikit-learn的Perceptron类实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">From sklearn.linear_model import Perception</span><br><span class="line">Per_clf = Perception(random_state=42)</span><br></pre></td></tr></table></figure>
</li>
<li><p>多层感知器（MLP）和反向传播<br>对每个训练实例，反向传播算法先正向进行一次预测，度量误差，然后反向遍历每个层次来度量每个连接的误差贡献度，最后微调每个连接的权重来降低误差（梯度下降）。</p>
</li>
<li>激活函数：双曲正切函数和RELU函数<h2 id="TensorFlow训练MLP"><a href="#TensorFlow训练MLP" class="headerlink" title="TensorFlow训练MLP"></a>TensorFlow训练MLP</h2><h3 id="最简单方式：使用TF-Learn"><a href="#最简单方式：使用TF-Learn" class="headerlink" title="最简单方式：使用TF.Learn"></a>最简单方式：使用TF.Learn</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Feature_columns = tf.contrib.learn.infer_real_valued_columns_from(X_train)</span><br><span class="line">Dnn_clf = tf.contrib.learn.DNNClassifier(hidden_units=[300,100], n_classes=10, features_columns=feature_columns)</span><br><span class="line">#activation_fn调整激活函数</span><br><span class="line">Dnn_clf.fit(X=X_train, y=y_train, batch_size=50, steps=40000)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>DNNClassifier背后默认基于relu激活函数创建所有神经元层次，输出层softmax，成本函数是交叉熵。</p>
<h3 id="纯TensorFlow训练DNN"><a href="#纯TensorFlow训练DNN" class="headerlink" title="纯TensorFlow训练DNN"></a>纯TensorFlow训练DNN</h3><p>构建阶段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Import tensorflow as tf</span><br><span class="line"></span><br><span class="line">#模型参数设置</span><br><span class="line">N_inputs = </span><br><span class="line">N_hidden1 =</span><br><span class="line">N_hidden2 =</span><br><span class="line">N_outputs =</span><br><span class="line"></span><br><span class="line">#占位符节点表示输入与目标</span><br><span class="line">X = tf.placeholder(tf.float32, shape=(None, n_inputs), name=“X”)</span><br><span class="line">y = tf.placeholder(tf.int32, shape=(None), name=“y”)</span><br><span class="line"></span><br><span class="line">#神经网络层</span><br><span class="line">Def neuron_layer（X， n_neurons, name, activation=None）:</span><br><span class="line">	with tf.name_scope(“name”):</span><br><span class="line">		n_inputs = int(X.get_shape()[1])</span><br><span class="line">	</span><br><span class="line">		studdev = 2/np.sqrt(n_inputs)</span><br><span class="line">		init = tf.truncated_normal((n_inputs, n_neurons), studded=stddev)</span><br><span class="line">		#tf.truncated_normal(shape，mean=0.0，stddev=1.0, dtype,seed=None, name=None)用于从截断的正态分布中输出随机值</span><br><span class="line">		#shape输出张量的形状</span><br><span class="line">		#mean是正态分布均值</span><br><span class="line">		#sddev是正太分布的标准差</span><br><span class="line">		#dtpye指输出的类型</span><br><span class="line">		#产生的数据-均值&lt;=2*标准差</span><br><span class="line">		#使用一个指定的标准偏差会让算法熟练的更快</span><br><span class="line">	</span><br><span class="line">		W = tf.Variable(init, name=“Weights”)</span><br><span class="line">		b = tf.Variavle(tf.zeros([n_neurons]),name=“bias” )	</span><br><span class="line">		z = tf.matmul(X,W)+b</span><br><span class="line">		if activation == “relu”:</span><br><span class="line">			return tf.nn.relu(z)</span><br><span class="line">		else:</span><br><span class="line">			return z</span><br><span class="line"></span><br><span class="line">#创建神经网络</span><br><span class="line">with tf.name_scope(“dnn”):</span><br><span class="line">		hidden1 = neuron_layer(X, n_hidden1, “hidden1”, activation=“relu”)</span><br><span class="line">		hidden2 = neuron_layer(X, n_hidden2, “hidden2”, activation=“relu”)</span><br><span class="line">		logits = neuron_layer(hidden2,  n_outputs, “outputs”)</span><br><span class="line"></span><br><span class="line">#使用full_conntected创建全连接层</span><br><span class="line">From tensorflow.contrib.layers import fully_connected</span><br><span class="line"></span><br><span class="line">With tf.name_scope(“dnn”):</span><br><span class="line">		hidden1 = fully_connected(X, n_hidden1, scope=“hidden1”)</span><br><span class="line">		hidden2 = fully_connected(hidden1, n_hidden2, scope=“hidden2”)</span><br><span class="line">		logits = fully_connected(hidden2, n_outputs, scope=“outputs”, activation_fn=None)</span><br><span class="line">		</span><br><span class="line">#损失函数</span><br><span class="line">with tf.name_scope(“loss”):</span><br><span class="line">		x_centropy = tf.nn.sparse_softmax_cross_entropy_with_logits(labels=y, logits=logits)</span><br><span class="line">		#根据logits计算交叉熵，计算出每个实例的交叉熵的一维张量</span><br><span class="line">		loss = tf.reduce_mean(xentropy, name=“loss”)</span><br><span class="line">		#计算所有实例的平均交叉熵</span><br><span class="line"></span><br><span class="line">Learning_rate = 0.01</span><br><span class="line">#梯度下降优化器</span><br><span class="line">with tf.name_scope(“train”):</span><br><span class="line">		optimizer = tf.train.GradientDescentOptimizer(learning_rate)</span><br><span class="line">		training_op = optimizer.minimizer(loss)</span><br><span class="line"></span><br><span class="line">#对模型求值</span><br><span class="line">with tf.name_scope(“eval”):</span><br><span class="line">		correct = tf.nn.in_top_k(logits, y, 1)</span><br><span class="line">		#判断target/y是否在前top k/1的预测logits之中，输出batch_size大小的预测数组</span><br><span class="line">		#此处即看y是否等于logits的最大数的索引值</span><br><span class="line">		accuracy = tf.reduce_mean(tf.cast(correct, tf.float32))</span><br><span class="line">		#tf.cast（x，dtype）将输入x转换为目标类型，返回一个张量，此处把bool型转化为float32来进行求平均计算</span><br><span class="line">		#tf.reduce_mean()计算张量沿指定轴的平均值，axis=None则求全局</span><br><span class="line">		#axis=n求平均，可以看作把张量第n维变为1 ？</span><br><span class="line">#保存</span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line">Saver = tf.train.Saver()</span><br></pre></td></tr></table></figure></p>
<p>执行阶段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">From tensorflow.examples.tutorials.mnist import input_data</span><br><span class="line">Mnist = input_data.read_data_sets(“/temp/data”)</span><br><span class="line"></span><br><span class="line">N_epochs = 400</span><br><span class="line">Batch_size = 50</span><br><span class="line"></span><br><span class="line">With tf.Session() as sess:</span><br><span class="line">		init.run()</span><br><span class="line">		for epoch in range(n_epochs):</span><br><span class="line">			for iteration in range(mnist.train.num_examples// batch_size):</span><br><span class="line">				X_batch, y_batch = mnist.train.next_batch(batch_size)</span><br><span class="line">				sess.run(training_op, feed_dict=&#123;X:X_batch, y:y_batch&#125;)</span><br><span class="line">			acc_train = accuracy.eval(feed_dict=&#123;X:X_batch, y:y_batch&#125;)</span><br><span class="line">			acc_test = accuracy.eval(feed_dict=&#123;X:mnist.test.images, y:mnist.test.labels&#125;)</span><br><span class="line">			print(“”)</span><br><span class="line">		save_path = saver.save(sess, “./model_final.ckpt”)</span><br></pre></td></tr></table></figure></p>
<p>使用神经网络<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">With tf.Session() as sess:</span><br><span class="line">		saver.restore(sess, “./model_final.ckpt”)</span><br><span class="line">		X_new_scaled = [...]</span><br><span class="line">		Z = logits.eval(feed_dict=&#123;X: X_new_scaled&#125;)</span><br><span class="line">		y_pred = np.argmax(Z, axis=1)</span><br></pre></td></tr></table></figure></p>
<h2 id="微调超参数"><a href="#微调超参数" class="headerlink" title="微调超参数"></a>微调超参数</h2><ul>
<li>随机搜素法</li>
<li>隐藏层的个数调整<br>深层网络比浅层网络有更高的参数效率，可以用更少的神经元建模复杂函数，加快训练，提高对新数据集的泛化能力。</li>
<li>每层神经元数<br>增加每层的神经元数量会比增加层数产生更多消耗。</li>
<li>更多的层次和神经元，提前结束训练，被称为“弹力裤”方法。</li>
<li>激活函数<br>大多情况可以在隐藏层中用ReLU<br>对于输出层：softmax对于互斥的分类任务是个不错的选择，回归任务可以不用激活函数</li>
</ul>
<p></p>
      <div class="post-button"><a class="btn" href="/mengxiao2000.github.io/2019/11/06/A8E255A0-8354-4CBC-A3C9-37F780898882/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>


<div id="pagination">
  <a class="extend prev" rel="prev" href="/mengxiao2000.github.io/">Prev</a><a class="page-number" href="/mengxiao2000.github.io/">1</a><span class="page-number current">2</span><a class="page-number" href="/mengxiao2000.github.io/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/mengxiao2000.github.io/page/6/">6</a><a class="extend next" rel="next" href="/mengxiao2000.github.io/page/3/">Next</a>
</div>

<footer>
  <div>
  Copyright &copy; 2021.<a href="/mengxiao2000.github.io/">黎明已经不远</a><br>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme <a href="https://lx.js.org" target="_blank">Lx</a><br>
  </div>
</footer>

  </div>
</div>
</div>

<button class="hamburger hamburger--arrow-r" type="button">
    <div class="hamburger-box">
      <div class="hamburger-inner"></div>
    </div>
</button> 
<div class="menu visibility">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/mengxiao2000.github.io/"><img src="/mengxiao2000.github.io/images/avatar.jpeg" alt="Syiao"></a>
          </div>
        </div>
        <div class="row for-name">
          <p>Syiao</p>
          <span class="tagline">Hello, World!</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>Home</a></li>
    <li><a href="/mengxiao2000.github.io/archives/"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
    
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-bookmark fa-fw"></i>Pages</span>
        <ul>
          <li><a href="/mengxiao2000.github.io/guestbook/">Guestbook</a></li>
        <li><a href="/mengxiao2000.github.io/about/">About</a></li>
        </ul>
    </li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-link fa-fw"></i>Friends</span>
        <ul>
          <li> <a href="https://lx.js.org" target="_blank">Theme-Lx</a></li>
        </ul>
    </li>
  </ul>
  </nav>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
<script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.easing.min.js"></script>
<script>
(function () {
	"use strict";
	var goToTop = function() {
		$(".js-gotop").on("click", function(event){
			event.preventDefault();
			$("html, body").animate({
				scrollTop: $("html").offset().top
			}, 500, "easeInOutExpo");
			return false;
		});
		$(window).scroll(function(){
			var $win = $(window);
			if ($win.scrollTop() > 200) {
				$(".js-top").addClass("active");
			} else {
				$(".js-top").removeClass("active");
			}
		});
	};
	$(function(){
		goToTop();
	});
}());
</script>



</body>
</html>
